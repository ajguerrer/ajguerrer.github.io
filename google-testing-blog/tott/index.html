<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Testing on the Toilet :: Notebook</title>

    
    <link href="/css/nucleus.css?1558239265" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1558239265" rel="stylesheet">
    <link href="/css/hybrid.css?1558239265" rel="stylesheet">
    <link href="/css/featherlight.min.css?1558239265" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1558239265" rel="stylesheet">
    <link href="/css/auto-complete.css?1558239265" rel="stylesheet">
    <link href="/css/theme.css?1558239265" rel="stylesheet">
    <link href="/css/hugo-theme.css?1558239265" rel="stylesheet">
    
      <link href="/css/theme-gruvbox.css?1558239265" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1558239265"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/google-testing-blog/tott/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div class="logo">
  <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 90.000000 183.000000"
    preserveAspectRatio="xMidYMid meet">
    <g transform="translate(0.000000,183.000000) scale(0.100000,-0.100000)" stroke="none">
      <path d="M437 1690 c-4 -30 -7 -131 -8 -225 -2 -224 -2 -224 -62 -242 -67 -19
    -147 -97 -147 -141 0 -18 2 -32 4 -32 2 0 15 17 29 38 27 41 104 96 150 107
    l28 7 -3 -107 -3 -108 -30 -11 c-54 -19 -106 -57 -103 -75 2 -9 35 -32 74 -51
    l72 -35 7 -68 c8 -84 17 -80 19 8 l1 66 58 24 c32 13 67 31 78 41 17 15 18 19
    4 34 -8 9 -42 29 -75 45 l-60 29 0 101 c0 56 3 104 6 107 7 8 100 -29 134 -53
    14 -10 41 -40 60 -68 31 -45 50 -62 50 -46 0 17 -43 85 -72 114 -33 34 -119
    81 -149 81 -19 0 -24 43 -35 309 -8 182 -17 235 -27 151z m-11 -806 l-7 -33
    -40 18 c-68 31 -68 38 -8 66 l54 25 3 -21 c2 -12 1 -36 -2 -55z m101 50 c24
    -9 43 -21 43 -25 0 -12 -40 -36 -72 -44 -27 -7 -28 -6 -28 39 0 25 3 46 7 46
    4 0 27 -7 50 -16z" />
      <path d="M92 893 c14 -133 101 -250 231 -311 37 -18 74 -32 81 -32 8 0 17 -4
20 -8 3 -5 6 -109 7 -231 0 -123 5 -219 9 -214 19 20 30 125 30 278 l0 165 28
6 c75 17 98 25 133 50 57 39 108 107 139 183 32 77 49 157 31 147 -6 -4 -11
-12 -11 -17 0 -6 -16 -49 -36 -95 -31 -72 -46 -93 -98 -138 -69 -60 -120 -81
-176 -72 -22 3 -41 2 -45 -4 -15 -25 -86 1 -173 63 -51 37 -127 151 -148 224
-9 29 -18 53 -21 53 -3 0 -3 -21 -1 -47z" />
    </g>
  </svg>
  <p>Notebook</p>
</div>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1558239265"></script>
<script type="text/javascript" src="/js/auto-complete.js?1558239265"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ajguerrer.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1558239265"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/google-testing-blog/" title="Google Testing Blog" class="dd-item 
        parent
        
        
        ">
      <a href="/google-testing-blog/">
          Google Testing Blog
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/tott/" title="Testing on the Toilet" class="dd-item active">
        <a href="/google-testing-blog/tott/">
        Testing on the Toilet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Notebook</a> > <a href='/google-testing-blog/'>Google Testing Blog</a> > Testing on the Toilet
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#exercise-service-call-contracts-in-tests">Exercise Service Call Contracts in Tests</a></li>
<li><a href="#make-interfaces-hard-to-misuse">Make Interfaces Hard to Misuse</a></li>
<li><a href="#only-verify-relevant-method-arguments">Only Verify Relevant Method Arguments</a></li>
<li><a href="#keep-tests-focused">Keep Tests Focused</a></li>
<li><a href="#understanding-code-in-review">Understanding Code in Review</a></li>
<li><a href="#cleanly-create-test-data">Cleanly Create Test Data</a></li>
<li><a href="#only-expect-state-changing-method-calls">Only Expect State-Changing Method Calls</a></li>
<li><a href="#obsessed-with-primitives">Obsessed With Primitives?</a></li>
<li><a href="#identifiernamingpostforworldwidewebblog">IdentifierNamingPostForWorldWideWebBlog</a></li>
<li><a href="#to-comment-or-not-to-comment">To Comment or Not to Comment</a></li>
<li><a href="#too-many-comments-on-your-code-reviews">Too Many Comments on Your Code Reviews?</a></li>
<li><a href="#reduce-nesting-reduce-complexity">Reduce Nesting, Reduce Complexity</a></li>
<li><a href="#keep-cause-and-effect-clear">Keep Cause and Effect Clear</a></li>
<li><a href="#what-makes-a-good-end-to-end-test">What Makes a Good End-to-End Test?</a></li>
<li><a href="#change-detector-tests-considered-harmful">Change-Detector Tests Considered Harmful</a></li>
<li><a href="#prefer-testing-public-apis-over-implementation-detail-classes">Prefer Testing Public APIs Over Implementation-Detail Classes</a></li>
<li><a href="#writing-descriptive-test-names">Writing Descriptive Test Names</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Testing on the Toilet</h1>
          

        




<h2 id="exercise-service-call-contracts-in-tests">Exercise Service Call Contracts in Tests</h2>

<p><em>November 27, 2018</em> -
<a href="https://testing.googleblog.com/2018/11/testing-on-toilet-exercise-service-call.html">original post</a></p>

<p>If the code under test relies on the contract of a service, prefer exercising the service call
instead of mocking it out. Some service owners provide a fake. Otherwise, use a hermetic server.</p>

<h2 id="make-interfaces-hard-to-misuse">Make Interfaces Hard to Misuse</h2>

<p><em>July 25, 2018</em> -
<a href="https://testing.googleblog.com/2018/07/code-health-make-interfaces-hard-to.html">original post</a></p>

<p>Don&rsquo;t push the responsibility of maintaining invariants on the caller.</p>

<div class="notices warning" ><pre><code class="language-cpp">class Vector {
  explicit Vector(int num_slots);
  int RemainingSlots() const;
  void AddSlots(int num_slots);
  void Insert(int value);
};
</code></pre>
</div>


<p>Caller needs to check <code>RemainingSlots</code> and if 0, <code>AddSlots</code> in order for <code>Insert</code> to work properly.</p>

<p><code>Insert</code> could automatically manage slots.</p>

<div class="notices tip" ><pre><code class="language-cpp">class Vector {
  explicit Vector(int num_slots);
  void Insert(int value);
};
</code></pre>
</div>


<p>Other examples:</p>

<ul>
<li><code>Initialize</code> / <code>Deitialize</code> functions.</li>
<li>Allowing partially created objects.</li>
<li>Parameters that can have invalid values.</li>
</ul>

<p>Sometimes it&rsquo;s not practical to have a foolproof interface. In those cases rely on static analysis
or documentation.</p>

<h2 id="only-verify-relevant-method-arguments">Only Verify Relevant Method Arguments</h2>

<p><em>June 26, 2018</em> -
<a href="https://testing.googleblog.com/2018/06/testing-on-toilet-only-verify-relevant.html">original post</a></p>

<p>Tests become fragile when they expect exact values on irrelevant arguments.</p>

<div class="notices warning" ><pre><code class="language-cpp">TEST_F(DisplayGreetingTest, ShowSpecialGreetingOnNewYearsDay) {
  fakeClock_.SetTime(kNewYearsDay);
  fakeUser_.SetName(&quot;Fake User&quot;);
  EXPECT_CALL(mockUserPrompter_, UpdatePrompt(&quot;Hi Fake User! Happy New Year!&quot;,
                                              TitleBar(&quot;2018-01-01&quot;),
                                              PromptStyle::kNormal));
  userGreeter_.DisplayGreeting();
}
</code></pre>
</div>


<p>Only verify one behavior per test. Only verify arguments that affect the correctness of the specific
behavior being tested.</p>

<div class="notices tip" ><pre><code class="language-cpp">TEST_F(DisplayGreetingTest, ShowSpecialGreetingOnNewYearsDay) {
  fakeClock_.SetTime(kNewYearsDay);
  EXPECT_CALL(mockUserPrompter_, UpdatePrompt(HasSubstr(&quot;Happy New Year!&quot;), _, _));
  userGreeter_.DisplayGreeting();
}

TEST_F(DisplayGreetingTest, RenderUserName) {
  fakeUser_.SetName(&quot;Fake User&quot;);
  EXPECT_CALL(mockUserPrompter_, UpdatePrompt(HasSubstr(&quot;Fake User&quot;), _, _));
  userGreeter_.DisplayGreeting();
}
</code></pre>
</div>


<h2 id="keep-tests-focused">Keep Tests Focused</h2>

<p><em>June 11, 2018</em> -
<a href="https://testing.googleblog.com/2018/06/testing-on-toilet-keep-tests-focused.html">original post</a></p>

<p>Testing too many scenarios at once can make it difficult to understand test and reason about the
failure.</p>

<div class="notices warning" ><pre><code class="language-cpp">TEST_F(BankAcountTest, WidthdrawFromAccount) {
  Transaction transaction = acceunt_.Deposit(Usd(5));
  clock_.AdvanceTime(kMinTimeToSettle);
  account_.Settle(transaction);

  EXPECT_THAT(account_.Withdraw(Usd(5)), IsOk());
  EXPECT_THAT(account_.Withdraw(USd(1)), IsRejected());
  account_.SetOverdraftLimit(Usd(1));
  EXPECT_THAT(account_.Withdraw(Usd(1)), IsOk());
}
</code></pre>
</div>


<p>Break up each scenario into its own test.</p>

<div class="notices tip" ><pre><code class="language-cpp">TEST_F(BankAccountTest, CanWithdrawWithinBalance) {
  DepositAndSettle(Usd(5));
  EXPECT_THAT(account_.Withdraw(Usd(5)), IsOk());
}

TEST_F(BankAccountTest, CannotOverdraw) {
  DepositAndSettle(Usd(5));
  EXPECT_THAT(account_.Withdraw(Usd(6)), IsRejected());
}

TEST_F(BankAccountTest, CanOverdrawUpToOverdraftLimit) {
  DepositAndSettle(Usd(5));
  account_.SetOverdraftLimit(Usd(1));
  EXPECT_THAT(account_.Withdraw(Usd(6)), IsOk());
}
</code></pre>
</div>


<p>Notice how each test only asserts on the output of one call per test.</p>

<h2 id="understanding-code-in-review">Understanding Code in Review</h2>

<p><em>May 1, 2018</em> - <a href="https://testing.googleblog.com/2018/05/code-health-understanding-code-in-review.html">original
post</a></p>

<p>If you find yourself reviewing code that is difficult to understand, don&rsquo;t waste time reviewing it.</p>

<div class="notices warning" ><pre><code class="language-cpp">bool IsOkay(int n) {
  bool f = false;
  for (int i = 2; i &lt;= n; ++i) {
    if (n % i == 0) f = true;
  }
  return !f;
}
</code></pre>
</div>


<p>Ask for it to be clarified.</p>

<div class="notices tip" ><pre><code class="language-cpp">bool IsPrime(int n) {
  for (int divisor = 2; divisor &lt;= n / 2; ++divisor) {
    if (n % divisor == 0) return false;
  }
  return true;
}
</code></pre>
</div>


<p>Clarifying code often results in noticing improvements.</p>

<h2 id="cleanly-create-test-data">Cleanly Create Test Data</h2>

<p><em>Febuary 20, 2018</em> - <a href="https://testing.googleblog.com/2018/02/testing-on-toilet-cleanly-create-test.html">original
post</a></p>

<p>Helper methods make it easier to create test data, but they don&rsquo;t age well.</p>

<div class="notices warning" ><pre><code class="language-cpp">// Starts simple
Company company = NewCompany(kPublic);

// But soon acquires more parameters
Company small = NewCompany(2, 2, nullptr, kPublic);
Company privately_owned = NewCompany(0, 0, nullptr, kPrivate);
Company bankrupt = NewCompany(0 , 0, kPastDate, kPublic);

// Or more methods
Company small = NewCompanyWithEmployeesAndBoardMembers(2, 2, kPublic);
Company privately_owned = NewCompanyWithType(kPrivate);
Company bankrupt = NewCompanyWithBankruptcyDate(kPastDate, kPublic);
</code></pre>
</div>


<p>Try the builder pattern.</p>

<div class="notices tip" ><pre><code class="language-cpp">Company small = Company::Builder{}.SetEmployees(2).SetBoardMembers(2).Build();
Company privately_owned = Company::Builder{}.SetType(kPrivate).Build();
Company bankrupt = Company::Builder{}.SetBankruptcyDate(kPastDate).Build();
Company default_company = Company::Builder{}.Build();

class Company::Builder {
public:
  Builder&amp; SetEmployees(int n) { employees_ = n; return *this; }
  Builder&amp; SetBoardMembers(int n) { board_members_ = n; return *this; }
  Builder&amp; SetBankruptcyDate(BankruptcyDate d) { date_ = d; return *this; }
  Builder&amp; SetType(Type t) { type_ = t; return *this; }

  Company Build() const { return Company(employees_, board_members_, date_, type_); }

private:
  int employees_ = 0;
  int board_members_ = 0;
  BankruptcyDate date_ = kBeforeDate;
  Type type_ = kPublic;
};
</code></pre>
</div>


<h2 id="only-expect-state-changing-method-calls">Only Expect State-Changing Method Calls</h2>

<p><em>December 11, 2017</em> - <a href="https://testing.googleblog.com/2017/12/testing-on-toilet-only-verify-state.html">original
post</a></p>

<p>Expecting calls to methods that don&rsquo;t change state can make a test brittle, less readable, and
provide a false sense of security.</p>

<div class="notices warning" ><pre><code class="language-cpp">TEST(UserAuthorizer, AddPermissionToDatabase) {
  UserAuthorizer user_authorizer(mock_user_service_, mock_permission_db_);

  EXPECT_CALL(mock_user_service_, IsUserActive(kUser);
  EXPECT_CALL(mock_permission_db_, GetPermission(kUser);
  EXPECT_CALL(mock_permission_db_, IsValidPermission(kReadAccess);
  EXPECT_CALL(mock_permission_db_, AddPermission(kUser, kReadAccess);

  user_authorizer.GrantPermission(kUser, kReadAccess);
}
</code></pre>
</div>


<p>Instead of expecting non-state-changing methods to be called, use them to verify state.</p>

<div class="notices warning" ><pre><code class="language-cpp">EXPECT_FALSE(IsUserActive(kUser));
</code></pre>
</div>


<p>With unnecessary <code>EXPECT_CALL</code>s removed, the test becomes:</p>

<div class="notices tip" ><pre><code class="language-cpp">Test(UserAuthorizer, AddPermissionToDatabase) {
  UserAuthorizer user_authorizer(mock_user_service_, mock_permission_db_);

  EXPECT_CALL(mock_permission_db_, AddPermission(kUser, kReadAccess);

  user_authorizer.GrantPermission(kUser, kReadAccess);
}
</code></pre>
</div>


<h2 id="obsessed-with-primitives">Obsessed With Primitives?</h2>

<p><em>November 14, 2017</em> - <a href="https://testing.googleblog.com/2017/11/obsessed-with-primitives.html">original
post</a></p>

<p>Code that relies too heavily on primitive types instead of custom abstractions can be hard to
understand and maintain.</p>

<div class="notices warning" ><pre><code class="language-cpp">std::vector&lt;std::pair&lt;int, int&gt;&gt; polygon = { std::make_pair(0, 0),
                                             std::make_pair(0, 4),
                                             std::make_pair(4, 0) };
std::pair&lt;std::pair&lt;int, int&gt;, std::pair&lt;int, int&gt;&gt; bounding_box = GetBoundingBox(polygon);
int area = (bounding_box.second.first  - bounding_box.first.first) *
           (bounding_box.second.second - bounding_box.first.second);

</code></pre>
</div>


<p>Make higher-level abstractions.</p>

<div class="notices tip" ><pre><code class="language-cpp">Polygon polygon = RightTriangle(4, 4);
int area = polygon.GetBoundingBox().GetArea();
</code></pre>
</div>


<p>This advice doesn&rsquo;t just apply to primitives and The STL. It&rsquo;s possible for any type to be too
primitive for the job.</p>

<div class="notices tip" ><pre><code class="language-cpp">Polygon polygon = IsoscelesRightTriangle(4);
int area = polygon.GetBoundingBox().GetArea();
</code></pre>
</div>


<h2 id="identifiernamingpostforworldwidewebblog">IdentifierNamingPostForWorldWideWebBlog</h2>

<p><em>October 23, 2017</em> - <a href="https://testing.googleblog.com/2017/10/code-health-identifiernamingpostforworl.html">original
post</a></p>

<p>Names should be clear and precise.</p>

<p>Don&rsquo;t mention the type in the variable name. It&rsquo;s OK for the name and the type match.</p>

<div class="notices warning" ><pre><code class="language-cpp">std::string nameString;
std::list&lt;std::time_t&gt; holidayDateList;
</code></pre>
</div>


<div class="notices tip" ><pre><code class="language-cpp">std::string name;
std::list&lt;std::time_t&gt; holidays;
Payments payments;
</code></pre>
</div>


<p>Don&rsquo;t use overly specific names. Get more specific if there is a need for disambiguation.</p>

<div class="notices warning" ><pre><code class="language-cpp">Monster final_battle_most_dangerous_boss_monster;
Payments non_typical_monthly_payments;
</code></pre>
</div>


<div class="notices tip" ><pre><code class="language-cpp">Monster boss;
Payments payments;
</code></pre>
</div>


<p>Do not repeat context.</p>

<div class="notices warning" ><pre><code class="language-cpp">class AnnualHolidaySale {
  bool PromoteHolidaySale();
  int annual_sale_rebate_;
};
</code></pre>
</div>


<div class="notices tip" ><pre><code class="language-cpp">class AnnualHolidaySale {
  bool Promote();
  int rebate_;
}
</code></pre>
</div>


<h2 id="to-comment-or-not-to-comment">To Comment or Not to Comment</h2>

<p><em>July 17, 2017</em> - <a href="https://testing.googleblog.com/2017/07/code-health-to-comment-or-not-to-comment.html">original
post</a></p>

<p>Comments are not always helpful.</p>

<div class="notices warning" ><pre><code class="language-cpp">// Subtract discount from final price.
final_price = (num_items * item_price) -
              std::min(5, num_items) * item_price *  0.1;

// Filter offensive words.
for (std::string word : words) { ... }

int width = ...; // Width in pixels.

// Safe since height is always &gt; 0.
return width / height;
</code></pre>
</div>


<p>It&rsquo;s often better to make your code self-explanatory.</p>

<div class="notices tip" ><pre><code class="language-cpp">price = num_items * item_price;
discount = std::min(5, num_items) * item_price * 0.1;
final_price = price - discount;

filterOffensiveWords(words);

Pixels width = ...;

checkArgument(height &gt; 0);
return width / height;
</code></pre>
</div>


<p>Avoid using comments to explain <em>what</em> code does. Use comments to explain <em>why</em> code does something.</p>

<h2 id="too-many-comments-on-your-code-reviews">Too Many Comments on Your Code Reviews?</h2>

<p><em>June 19, 2017</em> - <a href="https://testing.googleblog.com/2017/06/code-health-too-many-comments-on-your.html">original
post</a></p>

<p>Before you send out the code review:</p>

<ul>
<li>Review your own code first.</li>
<li>Discuss with colleagues.</li>
<li>Make bite-sized reviews.</li>
<li>Add comments to the code if necessary.</li>
</ul>

<p>When addressing code review comments:</p>

<ul>
<li>Review your code after addressing non-trivial comments.</li>
<li>Understand the reviews thought process.</li>
<li>Answer questions in the code.</li>
</ul>

<h2 id="reduce-nesting-reduce-complexity">Reduce Nesting, Reduce Complexity</h2>

<p><em>June 15, 2017</em> - <a href="https://testing.googleblog.com/2017/06/code-health-reduce-nesting-reduce.html">original
post</a></p>

<p>Deeply nested code is error-prone and hurts readability.</p>

<div class="notices warning" ><pre><code class="language-cpp">Response response = server.Call(request);

if (response.GetStatus() == Status::kOk) {
  if (!IsAuthorized(response.GetUser())) {
    if (response.GetEnc() == &quot;utf-8&quot;) {
      std::vector&lt;Row&gt; rows = response.GetRows();
      if (!rows.empty()) {
        avg = std::accumulate(rows.begin(), rows.end(), 0, ParseRow) / rows.size();
        return avg;
      } else {
      throw EmptyException();
    } else {
      throw AuthException('unauthorized');
    }
  } else {
    throw ValueException('wrong encoding');
  }
} else {
  throw RpcException(response.GetStatus());
}
</code></pre>
</div>


<p>The code above could be refactored using a technique called guard clause.</p>

<div class="notices tip" ><pre><code class="language-cpp">Response response = server.Call(request);

if (response.GetStatus() != Status::kOk) {
  throw RpcException(response.GetStatus());
}

if (!IsAuthorized(response.GetUser())) {
  throw ValueException('wrong encoding');
}

if (response.GetEnc() != &quot;utf-8&quot;) {
  throw AuthException('unauthorized');
}

std::vector&lt;Row&gt; rows = response.GetRows();
if (rows.empty()) {
  throw EmptyException();
}

avg = std::accumulate(rows.begin(), rows.end(), 0, ParseRow) / rows.size();
return avg;
</code></pre>
</div>


<p>Can you spot the bug now?</p>

<h2 id="keep-cause-and-effect-clear">Keep Cause and Effect Clear</h2>

<p><em>January 31, 2017</em> - <a href="https://testing.googleblog.com/2017/01/testing-on-toilet-keep-cause-and-effect.html">original
post</a></p>

<p>It&rsquo;s difficult to reason about a test when the cause is hidden far away from the effect.</p>

<div class="notices warning" ><pre><code class="language-cpp">class TallyTest : public ::testing::Test {
protected:
  void SetUp() override {
    tally_.Increment(&quot;key1&quot;, 8);
    tally_.Increment(&quot;key2&quot;, 100);
    tally_.Increment(&quot;key1&quot;, 0);
    tally_.Increment(&quot;key1&quot;, 1);
  }

  Tally tally_;
}
// 200 lines of code

TEST_F(TallyTest, IncrementExistingKey) {
  EXPECT_EQ(9, tally_.Get(&quot;key1&quot;));
}
</code></pre>
</div>


<p>Write tests where the effects immediately follow the causes.</p>

<div class="notices tip" ><pre><code class="language-cpp">class TallyTest : public ::testing::Test {
protected:
  Tally tally_;
}

TEST_F(TallyTest, NewKey) {
  tally_.Increment(&quot;key&quot;, 100);
  EXPECT_EQ(100, tally_.Get(&quot;key&quot;));
}

TEST_F(TallyTest, ExistingKey) {
  tally_.Increment(&quot;key&quot;, 8);
  tally_.Increment(&quot;key&quot;, 1);
  EXPECT_EQ(9, tally_.Get(&quot;key&quot;));
}

TEST_F(TallyTest, IncrementByZeroDoesNothing) {
  tally_.Increment(&quot;key&quot;, 8);
  tally_.Increment(&quot;key&quot;, 0);
  EXPECT_EQ(8, tally_.Get(&quot;key&quot;));
}
</code></pre>
</div>


<p>It may require a bit more code, but it&rsquo;s easier to read and maintain.</p>

<h2 id="what-makes-a-good-end-to-end-test">What Makes a Good End-to-End Test?</h2>

<p><em>September, 2016</em> - <a href="https://testing.googleblog.com/2016/09/testing-on-toilet-what-makes-good-end.html">original
post</a></p>

<p>End-to-end tests give confidence about the health of the system when it is in a near production
state, but they tend to be more flaky and expensive to maintain.</p>

<p>To be cost effective, end-to-end tests should focus on aspects of the system that cannot be
evaluated by smaller tests. Minor and/or frequently changing details like error messages or visual
layouts should not effect the test.</p>

<h2 id="change-detector-tests-considered-harmful">Change-Detector Tests Considered Harmful</h2>

<p><em>January 27, 2015</em> - <a href="https://testing.googleblog.com/2015/01/testing-on-toilet-change-detector-tests.html">original
post</a></p>

<p>Tests that break in response to any change to production code without verifying correct behavior
only add to maintenance costs without catching defects.</p>

<div class="notices warning" ><pre><code class="language-cpp">void Processor::Process(Work w) {
  first_part_.Process(w);
  second_part_.Process(w);
}

TEST(ProcessorTest, ProcessWork) {
  MockFirstPart part1;
  MockSecondPart part2;
  Processor p(part1, part2);
  Work w;

  EXPECT_CALL(part1, Process(w));
  EXPECT_CALL(part2, Process(w));

  p.Process(w);
}
</code></pre>
</div>


<p>Tests like these should either be re-written or deleted.</p>

<h2 id="prefer-testing-public-apis-over-implementation-detail-classes">Prefer Testing Public APIs Over Implementation-Detail Classes</h2>

<p><em>January 14, 2015</em> - <a href="https://testing.googleblog.com/2015/01/testing-on-toilet-prefer-testing-public.html">original
post</a></p>

<p>Public APIs can be called by many users. Implementation details are only called by public APIs.
If the public APIs are well tested, as they should be, then the implementation details will get
tested by association.</p>

<p>Heavy testing against implementation details can cause a couple problems:</p>

<ul>
<li>Unlike public APIs, implementation details are vulnerable to refactoring. Tests for implementation
details can fail even though the behavior from the public API is fine.</li>
<li>Testing implementation details can give false confidence. Even if an implementation detail is well
tested, that doesn&rsquo;t mean the pubic API behaves properly.</li>
</ul>

<h2 id="writing-descriptive-test-names">Writing Descriptive Test Names</h2>

<p><em>October 16, 2014</em> - <a href="https://testing.googleblog.com/2014/10/testing-on-toilet-writing-descriptive.html">original
post</a></p>

<p>Vague test names make it hard to keep track of what is tested.</p>

<div class="notices warning" ><pre><code class="language-cpp">TEST_F(IsUserLockedOutTest, InvalidLogin) {
  authenticator_.Authenticate(username_, password_);
  EXPECT_FALSE(authenticator_.IsUserLockedOut(username_));
  
  authenticator_.Authenticate(username_, password_);
  EXPECT_FALSE(authenticator_.IsUserLockedOut(username_));

  authenticator_.Authenticate(username_, password_);
  EXPECT_TRUE(authenticator_.IsUserLockedOut(username_));
}
</code></pre>
</div>


<p>Descriptive test names make it easy to tell what behavior is broken without looking at code. Also,
test names naturally become longer making for a good indicator that a test needs to be split apart.</p>

<div class="notices tip" ><pre><code class="language-cpp">TEST_F(IsUserLockedOutTest, ShouldLockOutUserAfterThreeInvalidLoginAttempts) {
 // ...
}
</code></pre>
</div>


<p>You should be able to understand the behavior being tested just by reading the test name. Make sure
the test names contain both the scenario being tested and the expected outcome.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/google-testing-blog/" title="Google Testing Blog"> <i class="fa fa-chevron-left"></i></a>
		
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1558239265"></script>
    <script src="/js/perfect-scrollbar.min.js?1558239265"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1558239265"></script>
    <script src="/js/jquery.sticky.js?1558239265"></script>
    <script src="/js/featherlight.min.js?1558239265"></script>
    <script src="/js/html5shiv-printshiv.min.js?1558239265"></script>
    <script src="/js/highlight.pack.js?1558239265"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1558239265"></script>
    <script src="/js/learn.js?1558239265"></script>
    <script src="/js/hugo-learn.js?1558239265"></script>

    <link href="/mermaid/mermaid.css?1558239265" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1558239265"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>


<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.64.0" />
    <meta name="theme-color" content="#85ad85">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="translucent">
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Testing on the Toilet :: Notebook</title>

    
    <link href="/css/nucleus.css?1582391604" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1582391604" rel="stylesheet">
    <link href="/css/hybrid.css?1582391604" rel="stylesheet">
    <link href="/css/featherlight.min.css?1582391604" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1582391604" rel="stylesheet">
    <link href="/css/auto-complete.css?1582391604" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1582391604" rel="stylesheet">
    <link href="/css/theme.css?1582391604" rel="stylesheet">
    <link href="/css/hugo-theme.css?1582391604" rel="stylesheet">
    
      <link href="/css/theme-gruvbox.css?1582391604" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1582391604"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link href="/css/gruvbox-dark.css" rel="stylesheet" />
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body class="" data-url="/google-testing-blog/tott/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div class="logo">
  <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 90.000000 183.000000"
    preserveAspectRatio="xMidYMid meet">
    <g transform="translate(0.000000,183.000000) scale(0.100000,-0.100000)" stroke="none">
      <path d="M437 1690 c-4 -30 -7 -131 -8 -225 -2 -224 -2 -224 -62 -242 -67 -19
    -147 -97 -147 -141 0 -18 2 -32 4 -32 2 0 15 17 29 38 27 41 104 96 150 107
    l28 7 -3 -107 -3 -108 -30 -11 c-54 -19 -106 -57 -103 -75 2 -9 35 -32 74 -51
    l72 -35 7 -68 c8 -84 17 -80 19 8 l1 66 58 24 c32 13 67 31 78 41 17 15 18 19
    4 34 -8 9 -42 29 -75 45 l-60 29 0 101 c0 56 3 104 6 107 7 8 100 -29 134 -53
    14 -10 41 -40 60 -68 31 -45 50 -62 50 -46 0 17 -43 85 -72 114 -33 34 -119
    81 -149 81 -19 0 -24 43 -35 309 -8 182 -17 235 -27 151z m-11 -806 l-7 -33
    -40 18 c-68 31 -68 38 -8 66 l54 25 3 -21 c2 -12 1 -36 -2 -55z m101 50 c24
    -9 43 -21 43 -25 0 -12 -40 -36 -72 -44 -27 -7 -28 -6 -28 39 0 25 3 46 7 46
    4 0 27 -7 50 -16z" />
      <path d="M92 893 c14 -133 101 -250 231 -311 37 -18 74 -32 81 -32 8 0 17 -4
20 -8 3 -5 6 -109 7 -231 0 -123 5 -219 9 -214 19 20 30 125 30 278 l0 165 28
6 c75 17 98 25 133 50 57 39 108 107 139 183 32 77 49 157 31 147 -6 -4 -11
-12 -11 -17 0 -6 -16 -49 -36 -95 -31 -72 -46 -93 -98 -138 -69 -60 -120 -81
-176 -72 -22 3 -41 2 -45 -4 -15 -25 -86 1 -173 63 -51 37 -127 151 -148 224
-9 29 -18 53 -21 53 -3 0 -3 -21 -1 -47z" />
    </g>
  </svg>
  <p>Notebook</p>
</div>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1582391604"></script>
<script type="text/javascript" src="/js/auto-complete.js?1582391604"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ajguerrer.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1582391604"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/google-testing-blog/" title="Google Testing Blog" class="dd-item 
        parent
        
        
        ">
      <a href="/google-testing-blog/">
          Google Testing Blog
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/general/" title="General Notes" class="dd-item ">
        <a href="/google-testing-blog/general/">
        General Notes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/testable_code/" title="Guide to Writing Testable Code" class="dd-item ">
        <a href="/google-testing-blog/testable_code/">
        Guide to Writing Testable Code
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/whittaker/" title="James Whittaker" class="dd-item ">
        <a href="/google-testing-blog/whittaker/">
        James Whittaker
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/tott/" title="Testing on the Toilet" class="dd-item active">
        <a href="/google-testing-blog/tott/">
        Testing on the Toilet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/unit-testing/" title="Unit Testing Principles, Practices, and Patterns" class="dd-item 
        
        
        
        ">
      <a href="/unit-testing/">
          Unit Testing Principles, Practices, and Patterns
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/bigger_picture/" title="The Bigger Picture" class="dd-item ">
        <a href="/unit-testing/bigger_picture/">
        The Bigger Picture
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/making_tests_work/" title="Making your Tests Work for You" class="dd-item ">
        <a href="/unit-testing/making_tests_work/">
        Making your Tests Work for You
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/integration_testing/" title="Integration Testing" class="dd-item ">
        <a href="/unit-testing/integration_testing/">
        Integration Testing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/antipatterns/" title="Unit Testing Anti-Patterns" class="dd-item ">
        <a href="/unit-testing/antipatterns/">
        Unit Testing Anti-Patterns
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Notebook</a> > <a href='/google-testing-blog/'>Google Testing Blog</a> > Testing on the Toilet
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#tests-too-dry-make-them-damp">Tests Too DRY? Make Them DAMP!</a></li>
    <li><a href="#exercise-service-call-contracts-in-tests">Exercise Service Call Contracts in Tests</a></li>
    <li><a href="#make-interfaces-hard-to-misuse">Make Interfaces Hard to Misuse</a></li>
    <li><a href="#only-verify-relevant-method-arguments">Only Verify Relevant Method Arguments</a></li>
    <li><a href="#keep-tests-focused">Keep Tests Focused</a></li>
    <li><a href="#understanding-code-in-review">Understanding Code in Review</a></li>
    <li><a href="#cleanly-create-test-data">Cleanly Create Test Data</a></li>
    <li><a href="#only-expect-state-changing-method-calls">Only Expect State-Changing Method Calls</a></li>
    <li><a href="#obsessed-with-primitives">Obsessed With Primitives?</a></li>
    <li><a href="#identifiernamingpostforworldwidewebblog">IdentifierNamingPostForWorldWideWebBlog</a></li>
    <li><a href="#to-comment-or-not-to-comment">To Comment or Not to Comment</a></li>
    <li><a href="#too-many-comments-on-your-code-reviews">Too Many Comments on Your Code Reviews?</a></li>
    <li><a href="#reduce-nesting-reduce-complexity">Reduce Nesting, Reduce Complexity</a></li>
    <li><a href="#keep-cause-and-effect-clear">Keep Cause and Effect Clear</a></li>
    <li><a href="#what-makes-a-good-end-to-end-test">What Makes a Good End-to-End Test?</a></li>
    <li><a href="#change-detector-tests-considered-harmful">Change-Detector Tests Considered Harmful</a></li>
    <li><a href="#prefer-testing-public-apis-over-implementation-detail-classes">Prefer Testing Public APIs Over Implementation-Detail Classes</a></li>
    <li><a href="#writing-descriptive-test-names">Writing Descriptive Test Names</a></li>
    <li><a href="#dont-put-logic-in-tests">Don&rsquo;t Put Logic in Tests</a></li>
    <li><a href="#risk-driven-testing">Risk-Driven Testing</a></li>
    <li><a href="#effective-testing">Effective Testing</a></li>
    <li><a href="#test-behaviors-not-methods">Test Behaviors, Not Methods</a></li>
    <li><a href="#what-makes-a-good-test">What Makes a Good Test?</a></li>
    <li><a href="#test-behavior-not-implementation">Test Behavior, Not Implementation</a></li>
    <li><a href="#know-your-test-doubles">Know Your Test Doubles</a></li>
    <li><a href="#fake-your-way-to-better-tests">Fake Your Way To Better Tests</a></li>
    <li><a href="#dont-overuse-mocks">Don&rsquo;t Overuse Mocks</a></li>
    <li><a href="#testing-state-vs-testing-interactions">Testing State vs. Testing Interactions</a></li>
    <li><a href="#code-coverage-goal-80-and-no-less">Code coverage goal: 80% and no less!</a></li>
    <li><a href="#data-driven-traps">Data Driven Traps!</a></li>
    <li><a href="#sleeping--synchronization">Sleeping != Synchronization</a></li>
    <li><a href="#defeat-static-cling">Defeat &ldquo;Static Cling&rdquo;</a></li>
    <li><a href="#testable-contracts-make-exceptional-neighbors">Testable Contracts Make Exceptional Neighbors</a></li>
    <li><a href="#understanding-your-coverage-data">Understanding Your Coverage Data</a></li>
    <li><a href="#too-many-tests">Too Many Tests</a></li>
    <li><a href="#avoiding-friend-twister-in-c">Avoiding Friend Twister in C++</a></li>
    <li><a href="#refactoring-tests-in-the-red">Refactoring Tests in the Red</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Testing on the Toilet
            </h1>
          

        



<p>This page contains potable bits of testing best-practices that will keep you riveted to
your seat.</p>
<h2 id="tests-too-dry-make-them-damp">Tests Too DRY? Make Them DAMP!</h2>
<p><em>December 03, 2019</em> -
<a href="https://testing.googleblog.com/2019/12/testing-on-toilet-tests-too-dry-make.html">original post</a></p>
<p>Though the DRY (&ldquo;Don&rsquo;t Repeat Yourself&rdquo;) principle is great for production code, tests don&rsquo;t test
themselves.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">ForumTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">:</span><span class="o">:</span><span class="n">testing</span><span class="o">:</span><span class="o">:</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">(</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">user</span> <span class="p">:</span> <span class="n">users_</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">forum_</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">Forum</span> <span class="n">forum_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users_</span> <span class="o">=</span> <span class="p">{</span><span class="n">User</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Alice</span><span class="s">&#34;</span><span class="p">)</span><span class="p">,</span> <span class="n">User</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Bob</span><span class="s">&#34;</span><span class="p">)</span><span class="p">}</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">ForumTest</span><span class="p">,</span> <span class="n">CanRegisterMultipleUsers</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">user</span> <span class="p">:</span> <span class="n">users_</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">forum_</span><span class="p">.</span><span class="n">HasRegisteredUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tests should optimize for readability, even at the expense of redundancy. Prefer the DAMP
(&ldquo;Descriptive and Meaningful Phrases&rdquo;) principle.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">ForumTest</span><span class="p">,</span> <span class="n">CanRegisterMultipleUsers</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Forum</span> <span class="n">forum</span><span class="p">;</span>
  <span class="n">User</span> <span class="nf">user1</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Alice</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
  <span class="n">User</span> <span class="nf">user2</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Bob</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
  <span class="n">forum</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span><span class="p">;</span>
  <span class="n">forum</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span><span class="p">;</span>

  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">forum</span><span class="p">.</span><span class="n">HasRegisteredUser</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">forum</span><span class="p">.</span><span class="n">HasRegisteredUser</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="exercise-service-call-contracts-in-tests">Exercise Service Call Contracts in Tests</h2>
<p><em>November 27, 2018</em> -
<a href="https://testing.googleblog.com/2018/11/testing-on-toilet-exercise-service-call.html">original post</a></p>
<p>If the code under test relies on the contract of a service, prefer exercising the service call
instead of mocking it out. Some service owners provide a fake. Otherwise, use a hermetic server.</p>
<h2 id="make-interfaces-hard-to-misuse">Make Interfaces Hard to Misuse</h2>
<p><em>July 25, 2018</em> -
<a href="https://testing.googleblog.com/2018/07/code-health-make-interfaces-hard-to.html">original post</a></p>
<p>Don&rsquo;t push the responsibility of maintaining invariants on the caller.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Vector</span> <span class="p">{</span>
  <span class="k">explicit</span> <span class="nf">Vector</span><span class="p">(</span><span class="kt">int</span> <span class="n">num_slots</span><span class="p">)</span><span class="p">;</span>
  <span class="kt">int</span> <span class="nf">RemainingSlots</span><span class="p">(</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">AddSlots</span><span class="p">(</span><span class="kt">int</span> <span class="n">num_slots</span><span class="p">)</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div></div>

<p>In the code above, the caller needs to check <code>RemainingSlots</code>, and if <code>0</code>, <code>AddSlots</code> in order for
<code>Insert</code> to work properly.</p>
<p>Instead, <code>Insert</code> could automatically manage slots.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Vector</span> <span class="p">{</span>
  <span class="k">explicit</span> <span class="nf">Vector</span><span class="p">(</span><span class="kt">int</span> <span class="n">num_slots</span><span class="p">)</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div></div>

<p>Other signs an interface is hard to use:</p>
<ul>
<li><code>Initialize</code> / <code>Deitialize</code> functions.</li>
<li>Allowing partially created objects.</li>
<li>Parameters that can have invalid values.</li>
</ul>
<p>Sometimes it&rsquo;s not practical to have a foolproof interface. In those cases rely on static analysis
or documentation.</p>
<h2 id="only-verify-relevant-method-arguments">Only Verify Relevant Method Arguments</h2>
<p><em>June 26, 2018</em> -
<a href="https://testing.googleblog.com/2018/06/testing-on-toilet-only-verify-relevant.html">original post</a></p>
<p>Tests become fragile when they expect exact values on irrelevant arguments.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">DisplayGreetingTest</span><span class="p">,</span> <span class="n">ShowSpecialGreetingOnNewYearsDay</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">fake_clock_</span><span class="p">.</span><span class="n">SetTime</span><span class="p">(</span><span class="n">kNewYearsDay</span><span class="p">)</span><span class="p">;</span>
  <span class="n">fake_user_</span><span class="p">.</span><span class="n">SetName</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Fake User</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_user_prompter_</span><span class="p">,</span> <span class="n">UpdatePrompt</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Hi Fake User! Happy New Year!</span><span class="s">&#34;</span><span class="p">,</span>
                                                <span class="n">TitleBar</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">2018-01-01</span><span class="s">&#34;</span><span class="p">)</span><span class="p">,</span>
                                                <span class="n">PromptStyle</span><span class="o">:</span><span class="o">:</span><span class="n">kNormal</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">user_greeter_</span><span class="p">.</span><span class="n">DisplayGreeting</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
<li>Only verify one behavior per test.</li>
<li>Only verify arguments that affect the correctness of the specific behavior being tested.</li>
</ul>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">DisplayGreetingTest</span><span class="p">,</span> <span class="n">ShowSpecialGreetingOnNewYearsDay</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">fake_clock_</span><span class="p">.</span><span class="n">SetTime</span><span class="p">(</span><span class="n">kNewYearsDay</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_user_prompter_</span><span class="p">,</span> <span class="n">UpdatePrompt</span><span class="p">(</span><span class="n">HasSubstr</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Happy New Year!</span><span class="s">&#34;</span><span class="p">)</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">user_greeter_</span><span class="p">.</span><span class="n">DisplayGreeting</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">DisplayGreetingTest</span><span class="p">,</span> <span class="n">RenderUserName</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">fake_user_</span><span class="p">.</span><span class="n">SetName</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Fake User</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_user_prompter_</span><span class="p">,</span> <span class="n">UpdatePrompt</span><span class="p">(</span><span class="n">HasSubstr</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Fake User</span><span class="s">&#34;</span><span class="p">)</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">user_greeter_</span><span class="p">.</span><span class="n">DisplayGreeting</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="keep-tests-focused">Keep Tests Focused</h2>
<p><em>June 11, 2018</em> -
<a href="https://testing.googleblog.com/2018/06/testing-on-toilet-keep-tests-focused.html">original post</a></p>
<p>Testing too many scenarios at once can make it difficult to understand test and reason about the
failure.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">BankAccountTest</span><span class="p">,</span> <span class="n">WithdrawFromAccount</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">account_</span><span class="p">.</span><span class="n">Deposit</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">clock_</span><span class="p">.</span><span class="n">AdvanceTime</span><span class="p">(</span><span class="n">kMinTimeToSettle</span><span class="p">)</span><span class="p">;</span>
  <span class="n">account_</span><span class="p">.</span><span class="n">Settle</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span><span class="p">;</span>

  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">account_</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">IsOk</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">account_</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="n">USd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">IsRejected</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">account_</span><span class="p">.</span><span class="n">SetOverdraftLimit</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">account_</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">IsOk</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Break up each scenario into its own test.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">BankAccountTest</span><span class="p">,</span> <span class="n">CanWithdrawWithinBalance</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">DepositAndSettle</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">account_</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">IsOk</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BankAccountTest</span><span class="p">,</span> <span class="n">CannotOverdraw</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">DepositAndSettle</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">account_</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">IsRejected</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BankAccountTest</span><span class="p">,</span> <span class="n">CanOverdrawUpToOverdraftLimit</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">DepositAndSettle</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">account_</span><span class="p">.</span><span class="n">SetOverdraftLimit</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">account_</span><span class="p">.</span><span class="n">Withdraw</span><span class="p">(</span><span class="n">Usd</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">IsOk</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice how each test only verifies the output of one call per test.</p>
<h2 id="understanding-code-in-review">Understanding Code in Review</h2>
<p><em>May 1, 2018</em> - <a href="https://testing.googleblog.com/2018/05/code-health-understanding-code-in-review.html">original
post</a></p>
<p>If you find yourself reviewing code that is difficult to understand, don&rsquo;t waste time reviewing it.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">IsOkay</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">=</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">!</span><span class="n">f</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ask for it to be clarified.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">IsPrime</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">divisor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">divisor</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">divisor</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="n">divisor</span> <span class="o">=</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Clarifying code often results in noticing improvements.</p>
<h2 id="cleanly-create-test-data">Cleanly Create Test Data</h2>
<p><em>February 20, 2018</em> - <a href="https://testing.googleblog.com/2018/02/testing-on-toilet-cleanly-create-test.html">original
post</a></p>
<p>Helper methods make it easier to create test data, but they don&rsquo;t age well.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Starts simple
</span><span class="c1"></span><span class="n">Company</span> <span class="n">company</span> <span class="o">=</span> <span class="n">NewCompany</span><span class="p">(</span><span class="n">kPublic</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// But soon acquires more parameters
</span><span class="c1"></span><span class="n">Company</span> <span class="n">small</span> <span class="o">=</span> <span class="n">NewCompany</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">kPublic</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">privately_owned</span> <span class="o">=</span> <span class="n">NewCompany</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">kPrivate</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">bankrupt</span> <span class="o">=</span> <span class="n">NewCompany</span><span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kPastDate</span><span class="p">,</span> <span class="n">kPublic</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// Or more methods
</span><span class="c1"></span><span class="n">Company</span> <span class="n">small</span> <span class="o">=</span> <span class="n">NewCompanyWithEmployeesAndBoardMembers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">kPublic</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">privately_owned</span> <span class="o">=</span> <span class="n">NewCompanyWithType</span><span class="p">(</span><span class="n">kPrivate</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">bankrupt</span> <span class="o">=</span> <span class="n">NewCompanyWithBankruptcyDate</span><span class="p">(</span><span class="n">kPastDate</span><span class="p">,</span> <span class="n">kPublic</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></div>

<p>Try the builder pattern.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Company</span> <span class="n">small</span> <span class="o">=</span> <span class="n">Company</span><span class="o">:</span><span class="o">:</span><span class="n">Builder</span><span class="p">{</span><span class="p">}</span><span class="p">.</span><span class="n">SetEmployees</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">.</span><span class="n">SetBoardMembers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">privately_owned</span> <span class="o">=</span> <span class="n">Company</span><span class="o">:</span><span class="o">:</span><span class="n">Builder</span><span class="p">{</span><span class="p">}</span><span class="p">.</span><span class="n">SetType</span><span class="p">(</span><span class="n">kPrivate</span><span class="p">)</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">bankrupt</span> <span class="o">=</span> <span class="n">Company</span><span class="o">:</span><span class="o">:</span><span class="n">Builder</span><span class="p">{</span><span class="p">}</span><span class="p">.</span><span class="n">SetBankruptcyDate</span><span class="p">(</span><span class="n">kPastDate</span><span class="p">)</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="n">Company</span> <span class="n">default_company</span> <span class="o">=</span> <span class="n">Company</span><span class="o">:</span><span class="o">:</span><span class="n">Builder</span><span class="p">{</span><span class="p">}</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Company</span><span class="o">:</span><span class="o">:</span><span class="n">Builder</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">SetEmployees</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="n">employees_</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">SetBoardMembers</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="n">board_members_</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">SetBankruptcyDate</span><span class="p">(</span><span class="n">BankruptcyDate</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="n">date_</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">SetType</span><span class="p">(</span><span class="n">Type</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="n">type_</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">Company</span> <span class="nf">Build</span><span class="p">(</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Company</span><span class="p">(</span><span class="n">employees_</span><span class="p">,</span> <span class="n">board_members_</span><span class="p">,</span> <span class="n">date_</span><span class="p">,</span> <span class="n">type_</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">employees_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">board_members_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">BankruptcyDate</span> <span class="n">date_</span> <span class="o">=</span> <span class="n">kBeforeDate</span><span class="p">;</span>
  <span class="n">Type</span> <span class="n">type_</span> <span class="o">=</span> <span class="n">kPublic</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="only-expect-state-changing-method-calls">Only Expect State-Changing Method Calls</h2>
<p><em>December 11, 2017</em> - <a href="https://testing.googleblog.com/2017/12/testing-on-toilet-only-verify-state.html">original
post</a></p>
<p>Expecting calls to methods that don&rsquo;t change state can make a test brittle, less readable, and
provide a false sense of security.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">UserAuthorizer</span><span class="p">,</span> <span class="n">AddPermissionToDatabase</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">UserAuthorizer</span> <span class="nf">user_authorizer</span><span class="p">(</span><span class="n">mock_user_service_</span><span class="p">,</span> <span class="n">mock_permission_db_</span><span class="p">)</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_user_service_</span><span class="p">,</span> <span class="n">IsUserActive</span><span class="p">(</span><span class="n">kUser</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_permission_db_</span><span class="p">,</span> <span class="n">GetPermission</span><span class="p">(</span><span class="n">kUser</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_permission_db_</span><span class="p">,</span> <span class="n">IsValidPermission</span><span class="p">(</span><span class="n">kReadAccess</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_permission_db_</span><span class="p">,</span> <span class="n">AddPermission</span><span class="p">(</span><span class="n">kUser</span><span class="p">,</span> <span class="n">kReadAccess</span><span class="p">)</span><span class="p">;</span>

  <span class="n">user_authorizer</span><span class="p">.</span><span class="n">GrantPermission</span><span class="p">(</span><span class="n">kUser</span><span class="p">,</span> <span class="n">kReadAccess</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It is fine, however, to use non-state-changing methods for simulating test conditions.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">ON_CALL</span><span class="p">(</span><span class="n">mock_user_service_</span><span class="p">,</span> <span class="n">IsUserActive</span><span class="p">(</span><span class="n">kUser</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></div>

<p>With unnecessary <code>EXPECT_CALL</code>s removed, the test becomes:</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Test</span><span class="p">(</span><span class="n">UserAuthorizer</span><span class="p">,</span> <span class="n">AddPermissionToDatabase</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">UserAuthorizer</span> <span class="nf">user_authorizer</span><span class="p">(</span><span class="n">mock_user_service_</span><span class="p">,</span> <span class="n">mock_permission_db_</span><span class="p">)</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_permission_db_</span><span class="p">,</span> <span class="n">AddPermission</span><span class="p">(</span><span class="n">kUser</span><span class="p">,</span> <span class="n">kReadAccess</span><span class="p">)</span><span class="p">;</span>

  <span class="n">user_authorizer</span><span class="p">.</span><span class="n">GrantPermission</span><span class="p">(</span><span class="n">kUser</span><span class="p">,</span> <span class="n">kReadAccess</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="obsessed-with-primitives">Obsessed With Primitives?</h2>
<p><em>November 14, 2017</em> - <a href="https://testing.googleblog.com/2017/11/obsessed-with-primitives.html">original
post</a></p>
<p>Code that relies too heavily on primitive types instead of custom abstractions can be hard to
understand and maintain.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">polygon</span> <span class="o">=</span> <span class="p">{</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">,</span>
                                             <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="p">,</span>
                                             <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span><span class="p">;</span>
<span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">bounding_box</span> <span class="o">=</span> <span class="n">GetBoundingBox</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounding_box</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">first</span>  <span class="o">-</span> <span class="n">bounding_box</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">*</span>
           <span class="p">(</span><span class="n">bounding_box</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">second</span> <span class="o">-</span> <span class="n">bounding_box</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="p">;</span>

</code></pre></div></div>

<p>Make higher-level abstractions.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Polygon</span> <span class="n">polygon</span> <span class="o">=</span> <span class="n">RightTriangle</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">area</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">.</span><span class="n">GetBoundingBox</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">GetArea</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></div>

<p>This advice doesn&rsquo;t just apply to primitives and The STL. It&rsquo;s possible for any type to be too
primitive for the job.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Polygon</span> <span class="n">polygon</span> <span class="o">=</span> <span class="n">IsoscelesRightTriangle</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">area</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">.</span><span class="n">GetBoundingBox</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">GetArea</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="identifiernamingpostforworldwidewebblog">IdentifierNamingPostForWorldWideWebBlog</h2>
<p><em>October 23, 2017</em> - <a href="https://testing.googleblog.com/2017/10/code-health-identifiernamingpostforworl.html">original
post</a></p>
<p>Names should be clear and precise.</p>
<p>Don&rsquo;t mention the type in the variable name. It&rsquo;s OK for the name and the type match.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">string</span> <span class="n">name_string</span><span class="p">;</span>
<span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">list</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">time_t</span><span class="o">&gt;</span> <span class="n">holiday_date_list</span><span class="p">;</span>
</code></pre></div></div>


<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
<span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">list</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">time_t</span><span class="o">&gt;</span> <span class="n">holidays</span><span class="p">;</span>
<span class="n">Payments</span> <span class="n">payments</span><span class="p">;</span>
</code></pre></div></div>

<p>Don&rsquo;t use overly specific names. Get more specific if there is a need for disambiguation.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Monster</span> <span class="n">final_battle_most_dangerous_boss_monster</span><span class="p">;</span>
<span class="n">Payments</span> <span class="n">non_typical_monthly_payments</span><span class="p">;</span>
</code></pre></div></div>


<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Monster</span> <span class="n">boss</span><span class="p">;</span>
<span class="n">Payments</span> <span class="n">payments</span><span class="p">;</span>
</code></pre></div></div>

<p>Do not repeat context.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">AnnualHolidaySale</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">PromoteHolidaySale</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">annual_sale_rebate_</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div></div>


<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">AnnualHolidaySale</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">Promote</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">rebate_</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="to-comment-or-not-to-comment">To Comment or Not to Comment</h2>
<p><em>July 17, 2017</em> - <a href="https://testing.googleblog.com/2017/07/code-health-to-comment-or-not-to-comment.html">original
post</a></p>
<p>Comments are not always helpful.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Subtract discount from final price.
</span><span class="c1"></span><span class="n">final_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_items</span> <span class="o">*</span> <span class="n">item_price</span><span class="p">)</span> <span class="o">-</span>
              <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span> <span class="o">*</span> <span class="n">item_price</span> <span class="o">*</span>  <span class="mf">0.1</span><span class="p">;</span>

<span class="c1">// Filter offensive words.
</span><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">string</span> <span class="nl">word</span> <span class="p">:</span> <span class="n">words</span><span class="p">)</span> <span class="p">{</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span> <span class="p">}</span>

<span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">;</span> <span class="c1">// Width in pixels.
</span><span class="c1"></span>
<span class="c1">// Safe since height is always &gt; 0.
</span><span class="c1"></span><span class="k">return</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">;</span>
</code></pre></div></div>

<p>It&rsquo;s often better to make your code self-explanatory.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">price</span> <span class="o">=</span> <span class="n">num_items</span> <span class="o">*</span> <span class="n">item_price</span><span class="p">;</span>
<span class="n">discount</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span> <span class="o">*</span> <span class="n">item_price</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">final_price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="n">discount</span><span class="p">;</span>

<span class="n">FilterOffensiveWords</span><span class="p">(</span><span class="n">words</span><span class="p">)</span><span class="p">;</span>

<span class="n">Pixels</span> <span class="n">width</span> <span class="o">=</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">;</span>

<span class="n">CheckArgument</span><span class="p">(</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="p">;</span>
<span class="k">return</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span><span class="p">;</span>
</code></pre></div></div>

<p>Avoid using comments to explain <em>what</em> code does. Use comments to explain <em>why</em> code does something.</p>
<h2 id="too-many-comments-on-your-code-reviews">Too Many Comments on Your Code Reviews?</h2>
<p><em>June 19, 2017</em> - <a href="https://testing.googleblog.com/2017/06/code-health-too-many-comments-on-your.html">original
post</a></p>
<p>Before you send out the code review:</p>
<ul>
<li>Review your own code first.</li>
<li>Discuss with colleagues.</li>
<li>Make bite-sized reviews.</li>
<li>Add comments to the code if necessary.</li>
</ul>
<p>When addressing code review comments:</p>
<ul>
<li>Review your code after addressing non-trivial comments.</li>
<li>Understand the reviews thought process.</li>
<li>Answer questions in the code.</li>
</ul>
<h2 id="reduce-nesting-reduce-complexity">Reduce Nesting, Reduce Complexity</h2>
<p><em>June 15, 2017</em> - <a href="https://testing.googleblog.com/2017/06/code-health-reduce-nesting-reduce.html">original
post</a></p>
<p>Deeply nested code is error-prone and hurts readability.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetStatus</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span><span class="o">=</span> <span class="n">Status</span><span class="o">:</span><span class="o">:</span><span class="n">kOk</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsAuthorized</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetUser</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetEnc</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span><span class="o">=</span> <span class="sa"></span><span class="s">&#34;</span><span class="s">utf-8</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">GetRows</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rows</span><span class="p">.</span><span class="n">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">accumulate</span><span class="p">(</span><span class="n">rows</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">rows</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ParseRow</span><span class="p">)</span> <span class="o">/</span> <span class="n">rows</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">avg</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nf">EmptyException</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nf">AuthException</span><span class="p">(</span><span class="err">&#39;</span><span class="n">unauthorized</span><span class="err">&#39;</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nf">ValueException</span><span class="p">(</span><span class="err">&#39;</span><span class="n">wrong</span> <span class="n">encoding</span><span class="err">&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="nf">RpcException</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetStatus</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The code above could be refactored to use guard clauses.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetStatus</span><span class="p">(</span><span class="p">)</span> <span class="o">!</span><span class="o">=</span> <span class="n">Status</span><span class="o">:</span><span class="o">:</span><span class="n">kOk</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="nf">RpcException</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetStatus</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IsAuthorized</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetUser</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="nf">ValueException</span><span class="p">(</span><span class="err">&#39;</span><span class="n">wrong</span> <span class="n">encoding</span><span class="err">&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">GetEnc</span><span class="p">(</span><span class="p">)</span> <span class="o">!</span><span class="o">=</span> <span class="sa"></span><span class="s">&#34;</span><span class="s">utf-8</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="nf">AuthException</span><span class="p">(</span><span class="err">&#39;</span><span class="n">unauthorized</span><span class="err">&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">GetRows</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rows</span><span class="p">.</span><span class="n">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="nf">EmptyException</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">avg</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">accumulate</span><span class="p">(</span><span class="n">rows</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">rows</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ParseRow</span><span class="p">)</span> <span class="o">/</span> <span class="n">rows</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="k">return</span> <span class="n">avg</span><span class="p">;</span>
</code></pre></div></div>

<p>Can you spot the bug now?</p>
<h2 id="keep-cause-and-effect-clear">Keep Cause and Effect Clear</h2>
<p><em>January 31, 2017</em> - <a href="https://testing.googleblog.com/2017/01/testing-on-toilet-keep-cause-and-effect.html">original
post</a></p>
<p>It&rsquo;s difficult to reason about a test when the cause is hidden far away from the effect.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">TallyTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">:</span><span class="o">:</span><span class="n">testing</span><span class="o">:</span><span class="o">:</span><span class="n">Test</span> <span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">(</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key1</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="p">;</span>
    <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key2</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="p">;</span>
    <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key1</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">;</span>
    <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key1</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Tally</span> <span class="n">tally_</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// 200 lines of code
</span><span class="c1"></span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">TallyTest</span><span class="p">,</span> <span class="n">IncrementExistingKey</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">tally_</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key1</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Write tests where the effects immediately follow the causes.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">TallyTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">:</span><span class="o">:</span><span class="n">testing</span><span class="o">:</span><span class="o">:</span><span class="n">Test</span> <span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="n">Tally</span> <span class="n">tally_</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">TallyTest</span><span class="p">,</span> <span class="n">NewKey</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">tally_</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">TallyTest</span><span class="p">,</span> <span class="n">ExistingKey</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="p">;</span>
  <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">tally_</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">TallyTest</span><span class="p">,</span> <span class="n">IncrementByZeroDoesNothing</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="p">;</span>
  <span class="n">tally_</span><span class="p">.</span><span class="n">Increment</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">tally_</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">key</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It may require a bit more code, but it&rsquo;s easier to read and maintain.</p>
<h2 id="what-makes-a-good-end-to-end-test">What Makes a Good End-to-End Test?</h2>
<p><em>September, 2016</em> - <a href="https://testing.googleblog.com/2016/09/testing-on-toilet-what-makes-good-end.html">original
post</a></p>
<p>End-to-end tests give confidence about the health of the system when it is in a near production
state, but they tend to be more flaky and expensive to maintain.</p>
<p>To be cost effective, end-to-end tests should focus on aspects of the system that cannot be
evaluated by smaller tests. Minor and/or frequently changing details like error messages or visual
layouts should not effect the test.</p>
<h2 id="change-detector-tests-considered-harmful">Change-Detector Tests Considered Harmful</h2>
<p><em>January 27, 2015</em> - <a href="https://testing.googleblog.com/2015/01/testing-on-toilet-change-detector-tests.html">original
post</a></p>
<p>Tests that break in response to any change to production code without verifying correct behavior
only add to maintenance costs without catching defects.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">Processor</span><span class="o">:</span><span class="o">:</span><span class="n">Process</span><span class="p">(</span><span class="n">Work</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">first_part_</span><span class="p">.</span><span class="n">Process</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="p">;</span>
  <span class="n">second_part_</span><span class="p">.</span><span class="n">Process</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">ProcessorTest</span><span class="p">,</span> <span class="n">ProcessWork</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockFirstPart</span> <span class="n">part1</span><span class="p">;</span>
  <span class="n">MockSecondPart</span> <span class="n">part2</span><span class="p">;</span>
  <span class="n">Processor</span> <span class="nf">p</span><span class="p">(</span><span class="n">part1</span><span class="p">,</span> <span class="n">part2</span><span class="p">)</span><span class="p">;</span>
  <span class="n">Work</span> <span class="n">w</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">part1</span><span class="p">,</span> <span class="n">Process</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">part2</span><span class="p">,</span> <span class="n">Process</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>

  <span class="n">p</span><span class="p">.</span><span class="n">Process</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tests like these should either be re-written or deleted.</p>
<h2 id="prefer-testing-public-apis-over-implementation-detail-classes">Prefer Testing Public APIs Over Implementation-Detail Classes</h2>
<p><em>January 14, 2015</em> - <a href="https://testing.googleblog.com/2015/01/testing-on-toilet-prefer-testing-public.html">original
post</a></p>
<p>Public APIs can be called by many users. Implementation details are only called by public APIs.
If the public APIs are well tested, as they should be, then the implementation details will get
tested by association.</p>
<p>Heavy testing against implementation details can cause a couple problems:</p>
<ul>
<li>Unlike public APIs, implementation details are vulnerable to refactoring. Tests for implementation
details can fail even though the behavior from the public API is fine.</li>
<li>Testing implementation details can give false confidence. Even if an implementation detail is well
tested, that doesn&rsquo;t mean the pubic API behaves properly.</li>
</ul>
<h2 id="writing-descriptive-test-names">Writing Descriptive Test Names</h2>
<p><em>October 16, 2014</em> - <a href="https://testing.googleblog.com/2014/10/testing-on-toilet-writing-descriptive.html">original
post</a></p>
<p>Vague test names make it hard to keep track of what is tested.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">IsUserLockedOutTest</span><span class="p">,</span> <span class="n">InvalidLogin</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">authenticator_</span><span class="p">.</span><span class="n">Authenticate</span><span class="p">(</span><span class="n">username_</span><span class="p">,</span> <span class="n">password_</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">authenticator_</span><span class="p">.</span><span class="n">IsUserLockedOut</span><span class="p">(</span><span class="n">username_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>

  <span class="n">authenticator_</span><span class="p">.</span><span class="n">Authenticate</span><span class="p">(</span><span class="n">username_</span><span class="p">,</span> <span class="n">password_</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">authenticator_</span><span class="p">.</span><span class="n">IsUserLockedOut</span><span class="p">(</span><span class="n">username_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>

  <span class="n">authenticator_</span><span class="p">.</span><span class="n">Authenticate</span><span class="p">(</span><span class="n">username_</span><span class="p">,</span> <span class="n">password_</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">authenticator_</span><span class="p">.</span><span class="n">IsUserLockedOut</span><span class="p">(</span><span class="n">username_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Descriptive test names make it easy to tell what behavior is broken without looking at code. Also,
the length of a good test name helps indicate when a test needs to be split apart.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">IsUserLockedOutTest</span><span class="p">,</span> <span class="n">ShouldLockOutUserAfterThreeInvalidLoginAttempts</span><span class="p">)</span> <span class="p">{</span>
 <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div></div>

<p>A test&rsquo;s name should be all you need to know to understand the behavior being tested. Make sure
the name contains both the scenario being tested and the expected outcome.</p>
<h2 id="dont-put-logic-in-tests">Don&rsquo;t Put Logic in Tests</h2>
<p><em>July 31, 2014</em> - <a href="https://testing.googleblog.com/2014/07/testing-on-toilet-dont-put-logic-in.html">original
post</a></p>
<p>Tests should be simple by stating I/O directly rather than computing them.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">NavigatorTest</span><span class="p">,</span> <span class="n">ShouldNavigateToPhotosPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">string</span> <span class="n">baseUrl</span> <span class="o">=</span> <span class="sa"></span><span class="s">&#34;</span><span class="s">http://plus.google.com/</span><span class="s">&#34;</span><span class="p">;</span>
  <span class="n">Navigator</span> <span class="nf">nav</span><span class="p">(</span><span class="n">baseUrl</span><span class="p">)</span><span class="p">;</span>
  <span class="n">nav</span><span class="p">.</span><span class="n">GoToPhotosPage</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">baseUrl</span> <span class="o">+</span> <span class="sa"></span><span class="s">&#34;</span><span class="s">/u/0/photos</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">nav</span><span class="p">.</span><span class="n">GetCurrentUrl</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Even a simple string concatenation can lead to bugs.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">NavigatorTest</span><span class="p">,</span> <span class="n">ShouldNavigateToPhotosPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Navigator</span> <span class="nf">nav</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">http://plug.google.com/</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
  <span class="n">nav</span><span class="p">.</span><span class="n">GoToPhotosPage</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">http://plus.google.com//u/0/photos</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">nav</span><span class="p">.</span><span class="n">GetCurrentUrl</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If a test requires logic, move that logic out of the test body into utilities and helper functions
and write tests for them too.</p>
<h2 id="risk-driven-testing">Risk-Driven Testing</h2>
<p><em>May 30, 2014</em> - <a href="https://testing.googleblog.com/2014/05/testing-on-toilet-risk-driven-testing.html">original
post</a></p>
<p>Blindly writing tests can lead to a false sense of security or wasted effort. Before writing tests,
think about testing. Small tests are cheap, larger tests protect core use-cases and integration.
Manual testing can sometimes be the cheapest, most effective option.</p>
<h2 id="effective-testing">Effective Testing</h2>
<p><em>May 7, 2014</em> - <a href="https://testing.googleblog.com/2014/05/testing-on-toilet-effective-testing.html">original
post</a></p>
<p>To be effective, a test maximizes three important qualities:</p>
<ul>
<li><strong>Fidelity</strong> - Sensitive to defects in the code under test.</li>
<li><strong>Resilience</strong> - Fails only when a breaking change is made to the code under test.</li>
<li><strong>Precision</strong> - Upon failure reports exactly where the defect lies.</li>
</ul>
<h2 id="test-behaviors-not-methods">Test Behaviors, Not Methods</h2>
<p>A single method can exhibit many behaviors. Likewise, a single behavior can span multiple methods.</p>
<p>It can be harmful to think that tests and public methods should have a 1:1 relationship.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">TransactionProcessorTest</span><span class="p">,</span> <span class="n">ProcessTransaction</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">NewUserWithBalance</span><span class="p">(</span><span class="n">kLowBalanceThreshold</span> <span class="o">+</span> <span class="n">Dollars</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">transaction_processor_</span><span class="p">.</span><span class="n">ProcessTransaction</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Pile of Beanie Babies</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">Dollars</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">ui_</span><span class="p">.</span><span class="n">GetText</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">HasSubstr</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">You bought a Pile of Beanie Babies</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">GetEmails</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_STREQ</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">GetEmails</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="p">.</span><span class="n">GetSubject</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;</span><span class="s">Your balance is low</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Each test should verify one behavior. Each method may take several tests to verify.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">TransactionProcessorTest</span><span class="p">,</span> <span class="n">ShouldDisplayNotification</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">transaction_processor_</span><span class="p">.</span><span class="n">ProcessTransaction</span><span class="p">(</span><span class="n">User</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">Pile of Beanie Babies</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">ui_</span><span class="p">.</span><span class="n">GetText</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">HasSubstr</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">You bought a Pile of Beanie Babies</span><span class="s">&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">TransactionProcessorTest</span><span class="p">,</span> <span class="n">ShouldSendEmailWhenBalanceIsLow</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">NewUserWithBalance</span><span class="p">(</span><span class="n">kLowBalanceThreshold</span> <span class="o">+</span> <span class="n">Dollars</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">transaction_processor_</span><span class="p">.</span><span class="n">ProcessTransaction</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">(</span><span class="n">Dollars</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">GetEmails</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_STREQ</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">GetEmails</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="p">.</span><span class="n">GetSubject</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="sa"></span><span class="s">&#34;</span><span class="s">Your balance is low</span><span class="s">&#34;</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="what-makes-a-good-test">What Makes a Good Test?</h2>
<p>Tests provide more than verification. They also serve as documentation.</p>
<p>As a source of documentation, test should not be distracting or hide information.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">CalculatorTest</span><span class="p">,</span> <span class="n">ShouldPerformAddition</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Calculator</span> <span class="nf">calculator</span><span class="p">(</span><span class="n">RoundingStrategy</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
    <span class="sa"></span><span class="s">&#34;</span><span class="s">unused</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">kEnableCosinFeature</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">kCalculusEngine</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">.</span><span class="n">DoComputation</span><span class="p">(</span><span class="n">MakeTestComputation</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>


<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_</span><span class="p">(</span><span class="n">CalculatorTest</span><span class="p">,</span> <span class="n">ShouldPerformAddition</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator_</span><span class="p">.</span><span class="n">DoComputation</span><span class="p">(</span><span class="n">MakeAdditionComputation</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="test-behavior-not-implementation">Test Behavior, Not Implementation</h2>
<p><em>August 5, 2013</em> - <a href="https://testing.googleblog.com/2013/08/testing-on-toilet-test-behavior-not.html">original
post</a></p>
<p>Except where explicitly intended, tests should work independent of the implementation details being
tested.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Calculator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Calculator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Adder</span> <span class="n">adder</span> <span class="o">=</span> <span class="n">adder_factory_</span><span class="p">.</span><span class="n">CreateAdder</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">ReturnValue</span> <span class="n">return_value</span> <span class="o">=</span> <span class="n">adder</span><span class="p">.</span><span class="n">Compute</span><span class="p">(</span><span class="n">Number</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="p">,</span> <span class="n">Number</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">return_value</span><span class="p">.</span><span class="n">ConvertToInteger</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">AdderFactory</span> <span class="n">adder_factory_</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">CalculatorTest</span><span class="p">,</span> <span class="n">ShouldAddIntegers</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">calculator_</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">calculator_</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">calculator_</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="know-your-test-doubles">Know Your Test Doubles</h2>
<p><em>July 18, 2013</em> - <a href="https://testing.googleblog.com/2013/07/testing-on-toilet-know-your-test-doubles.html">original
post</a></p>
<p>A test double is an object that can stand in for a real object in test. The most common types of
test doubles are:</p>
<ul>
<li>
<p><strong>Stub</strong> - Returns a specific values to promote a specific state.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">AccessManager</span> <span class="nf">access_manager</span><span class="p">(</span><span class="n">kStubAuthenticationService</span><span class="p">)</span><span class="p">;</span>

<span class="n">ON_CALL</span><span class="p">(</span><span class="n">kStubAuthenticationService</span><span class="p">,</span> <span class="n">IsAuthenticated</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">access_manager</span><span class="p">.</span><span class="n">UserHasAccess</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>

<span class="n">ON_CALL</span><span class="p">(</span><span class="n">kStubAuthenticationService</span><span class="p">,</span> <span class="n">IsAuthenticated</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">access_manager</span><span class="p">.</span><span class="n">UserHasAccess</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></li>
<li>
<p><strong>Mock</strong> - Sets expectations about how other objects should interact with it.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">AccessManager</span> <span class="nf">access_manager</span><span class="p">(</span><span class="n">mockAuthenticationService</span><span class="p">)</span><span class="p">;</span>

<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mockAuthenticationService</span><span class="p">,</span> <span class="n">IsAuthenticated</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="n">access_manager</span><span class="p">.</span><span class="n">UserHasAccess</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></li>
<li>
<p><strong>Fake</strong> - A lightweight implementation when the real implementation is unsuitable for test.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">FakeAuthenticationService</span> <span class="n">fake_authentication_service</span><span class="p">;</span>
<span class="n">AccessManager</span> <span class="nf">access_manager</span><span class="p">(</span><span class="n">fake_authentication_service</span><span class="p">)</span><span class="p">;</span>

<span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">access_manager</span><span class="p">.</span><span class="n">UserHasAccess</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>

<span class="n">fake_authentication_service</span><span class="p">.</span><span class="n">AddAuthenticatedUser</span><span class="p">(</span><span class="n">kUser</span><span class="p">)</span><span class="p">;</span>
<span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">access_manager</span><span class="p">.</span><span class="n">UserHasAccess</span><span class="p">(</span><span class="n">kUserId</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
</code></pre></div></li>
</ul>
<h2 id="fake-your-way-to-better-tests">Fake Your Way To Better Tests</h2>
<p><em>June 28, 2013</em> - <a href="https://testing.googleblog.com/2013/06/testing-on-toilet-fake-your-way-to.html">original
post</a></p>
<p>Suppose you would like to test your blog platform API, but you don&rsquo;t want your tests talking to a
remote server.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">DeletePostsWithTag</span><span class="p">(</span><span class="k">const</span> <span class="n">Tag</span><span class="o">&amp;</span> <span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Post</span> <span class="nl">post</span> <span class="p">:</span> <span class="n">blog_service_</span><span class="o">-</span><span class="o">&gt;</span><span class="n">GetAllPosts</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">HasTag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">blog_service_</span><span class="o">-</span><span class="o">&gt;</span><span class="n">DeletePost</span><span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">GetId</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>A fake is a lightweight implementation of an API that behaves like the real implementation, but
isn&rsquo;t suitable for production.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">FakeBlogService</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BlogService</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">AddPost</span><span class="p">(</span><span class="k">const</span> <span class="n">Post</span><span class="o">&amp;</span> <span class="n">post</span><span class="p">)</span> <span class="p">{</span> <span class="n">posts</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">DeletePost</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">post</span> <span class="p">:</span> <span class="n">posts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">post</span><span class="p">.</span><span class="n">GetId</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span><span class="o">=</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="n">posts</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">set</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="n">GetAllPosts</span><span class="p">(</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">posts</span><span class="p">;</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">set</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span> <span class="n">posts</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div><p>Fakes should be created and maintained by the person or team that owns the real implementation.</p>
<p>Fakes should have their own tests to make sure they behave like the real implementation.</p>
<h2 id="dont-overuse-mocks">Don&rsquo;t Overuse Mocks</h2>
<p><em>May 28, 2013</em> - <a href="https://testing.googleblog.com/2013/05/testing-on-toilet-dont-overuse-mocks.html">original
post</a></p>
<p>Mocks are powerful, but easy to abuse.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">PaymentProcessorTest</span><span class="p">,</span> <span class="n">ShouldChargeCreditCard</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">PaymentProcessor</span> <span class="nf">payment_processor</span><span class="p">(</span><span class="n">mock_credit_card_server_</span><span class="p">)</span><span class="p">;</span>

  <span class="n">InSequence</span> <span class="n">s</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_credit_card_server_</span><span class="p">,</span> <span class="n">IsServerAvailable</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_credit_card_server_</span><span class="p">,</span> <span class="n">BeginTransaction</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">mock_transaction_manager_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_transaction_manager_</span><span class="p">,</span> <span class="n">GetTransaction</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">transaction_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_credit_card_server_</span><span class="p">,</span> <span class="n">Pay</span><span class="p">(</span><span class="n">transaction_</span><span class="p">,</span> <span class="n">credit_card_</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">mock_payment_</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_payment_</span><span class="p">,</span> <span class="n">IsOverMaxBalance</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>

  <span class="n">payment_processor</span><span class="p">.</span><span class="n">ProcessPayment</span><span class="p">(</span><span class="n">credit_card_</span><span class="p">,</span> <span class="n">Dollars</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Overusing mocks makes tests harder to understand, maintain, and provides less insurance that your
code is working properly.</p>
<p>If you don&rsquo;t need a mock, don&rsquo;t use one. Understanding when to use a mock comes from understanding
what you want to test.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST_F</span><span class="p">(</span><span class="n">PaymentProcessorTest</span><span class="p">,</span> <span class="n">ShouldChargeCreditCard</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">PaymentProcessor</span> <span class="nf">payment_processor</span><span class="p">(</span><span class="n">credit_card_server_</span><span class="p">)</span><span class="p">;</span>
  <span class="n">payment_processor</span><span class="p">.</span><span class="n">ProcessPayment</span><span class="p">(</span><span class="n">credit_card_</span><span class="p">,</span> <span class="n">Dollars</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">credit_card_server_</span><span class="p">.</span><span class="n">GetMostRecentCharge</span><span class="p">(</span><span class="n">credit_card_</span><span class="p">)</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="testing-state-vs-testing-interactions">Testing State vs. Testing Interactions</h2>
<p><em>March 22, 2013</em> -
<a href="https://testing.googleblog.com/2013/03/testing-on-toilet-testing-state-vs.html">original post</a></p>
<ul>
<li>
<p><strong>Testing State</strong> - Verifying the code under test returns the correct results.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">NumberSorterTest</span><span class="p">,</span> <span class="n">ShouldSortIntegers</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NumberSorter</span> <span class="nf">number_sorter</span><span class="p">(</span><span class="p">{</span><span class="n">quicksort</span><span class="p">,</span> <span class="n">bubblesort</span><span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span><span class="p">,</span> <span class="n">number_sorter</span><span class="p">.</span><span class="n">SortNumbers</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></li>
<li>
<p><strong>Testing Interaction</strong> - Verifying the code under test calls methods correctly.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">NumberSorterTest</span><span class="p">,</span> <span class="n">ShouldUseQuicksort</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NumberSorter</span> <span class="nf">number_sorter</span><span class="p">(</span><span class="p">{</span><span class="n">mock_quicksort</span><span class="p">,</span> <span class="n">mock_bubblesort</span><span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_quicksort</span><span class="p">,</span> <span class="n">Sort</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span><span class="p">;</span>
  <span class="n">number_sorter</span><span class="p">.</span><span class="n">SortNumbers</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<p>Most of the time you want to test state. Occasionally interactions need to be tested when the number
of calls or order of calls matter.</p>
<h2 id="code-coverage-goal-80-and-no-less">Code coverage goal: 80% and no less!</h2>
<p><em>July 20, 2010</em> -
<a href="https://testing.googleblog.com/2010/07/code-coverage-goal-80-and-no-less.html">original post</a></p>
<p>Early one morning, a young programmer asked the great master, “I am ready to write some unit tests.
What code coverage should I aim for?”</p>
<p>The great master replied, “Don’t worry about coverage, just write some good tests.”</p>
<p>The young programmer smiled, bowed, and left.</p>
<p>Later that day, a second programmer asked the same question. The great master pointed at a pot of
boiling water and asked, “How many grains of rice should I put in that pot?”</p>
<p>The programmer, looking puzzled, replied, “How can I possibly tell you? It depends on how many
people you need to feed, how hungry they are, what other food you are serving, how much rice you
have available, and so on.”</p>
<p>“Exactly,” said the great master.</p>
<p>The second programmer smiled, bowed, and left.</p>
<p>Toward the end of the day, a third programmer came and asked the same question about code coverage.</p>
<p>“Eighty percent and no less!” Replied the master in a stern voice, pounding his fist on the table.</p>
<p>The third programmer smiled, bowed, and left.</p>
<p>After this last reply, a young apprentice approached the great master, “Great master, today I
overheard you answer the same question about code coverage with three different answers. Why?”</p>
<p>The great master stood up from his chair. “Come get some fresh tea with me and let’s talk about it.”
After they filled their cups with smoking hot green tea, the great master began:</p>
<p>“The first programmer is new and just getting started with testing. Right now he has a lot of code
and no tests. He has a long way to go; focusing on code coverage at this time would be depressing
and quite useless. He’s better off just getting used to writing and running some tests. He can worry
about coverage later.</p>
<p>&ldquo;The second programmer, on the other hand, is quite experienced both at programming and testing.
When I replied by asking her how many grains of rice I should put in a pot, I helped her realize
that the amount of testing necessary depends on a number of factors, and she knows those factors
better than I do – it’s her code after all. There is no single, simple, answer, and she’s smart
enough to handle the truth and work with that.”</p>
<p>“I see,” said the young apprentice, “but if there is no single simple answer, then why did you tell
the third programmer ‘Eighty percent and no less’?”</p>
<p>The great master laughed so hard and loud that his belly, evidence that he drank more than just
green tea, flopped up and down. “The third programmer wants only simple answers – even when there
are no simple answers … and then does not follow them anyway.”</p>
<p>The young apprentice and the grizzled great master finished drinking their tea in contemplative
silence.</p>
<h2 id="data-driven-traps">Data Driven Traps!</h2>
<p><em>September 4, 2008</em> -
<a href="https://testing.googleblog.com/2008/09/tott-data-driven-traps.html">original post</a></p>
<p>Data driven tests are efficient, but easy to abuse.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">TestData</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">string</span> <span class="n">word</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_word</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">TestData</span><span class="o">&gt;</span> <span class="n">test_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="sa"></span><span class="s">&#34;</span><span class="s">milk</span><span class="s">&#34;</span><span class="p">,</span> <span class="nb">true</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span><span class="sa"></span><span class="s">&#34;</span><span class="s">centre</span><span class="s">&#34;</span><span class="p">,</span> <span class="nb">false</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span><span class="sa"></span><span class="s">&#34;</span><span class="s">jklm</span><span class="s">&#34;</span><span class="p">,</span> <span class="nb">false</span><span class="p">}</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">IsWordTest</span><span class="p">,</span> <span class="n">TestEverything</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">entry</span> <span class="p">:</span> <span class="n">test_data</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">IsWord</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">word</span><span class="p">)</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">is_word</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Data-driven tests make debugging and understanding failures, let alone false positives, more
difficult.</p>
<p>As the code grows in complexity, data tends to grow even faster. It quickly becomes impossible to
discern what behavior each piece of data is meant to test.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Locale</span><span class="o">&gt;</span> <span class="n">locales</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">US</span><span class="p">,</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">UK</span><span class="p">,</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">France</span><span class="p">,</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span> <span class="p">}</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">TestData</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">string</span> <span class="n">word</span><span class="p">;</span>
  <span class="kt">bool</span><span class="p">[</span><span class="n">kNumLocales</span><span class="p">]</span> <span class="n">is_word</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">TestData</span><span class="o">&gt;</span> <span class="n">test_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="sa"></span><span class="s">&#34;</span><span class="s">milk</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span><span class="sa"></span><span class="s">&#34;</span><span class="s">centre</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nb">false</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">}</span><span class="p">}</span><span class="p">,</span>
    <span class="p">{</span><span class="sa"></span><span class="s">&#34;</span><span class="s">jklm</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">{</span><span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">}</span><span class="p">}</span><span class="p">,</span>
<span class="p">}</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">IsWordTest</span><span class="p">,</span> <span class="n">TestEverything</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">entry</span> <span class="p">:</span> <span class="n">test_data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">*</span> <span class="nl">locale</span><span class="p">:</span> <span class="n">locales</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">IsWord</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">word</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span><span class="p">,</span> <span class="n">entry</span><span class="p">.</span><span class="n">is_word</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Instead, think critically about what behaviors are worth testing.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">IsWordTest</span><span class="p">,</span> <span class="n">ShouldExistInMultipleLocales</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">IsWord</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">milk</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">US</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">IsWord</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">milk</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">UK</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">IsWord</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">milk</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">France</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">IsWordTest</span><span class="p">,</span> <span class="n">ShouldNotExist</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// &#34;jklm&#34; test not repeated as it uses the same code path
</span><span class="c1"></span>  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">IsWord</span><span class="p">(</span><span class="sa"></span><span class="s">&#34;</span><span class="s">jklm</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">Word</span><span class="o">:</span><span class="o">:</span><span class="n">US</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="sleeping--synchronization">Sleeping != Synchronization</h2>
<p><em>August 21, 2008</em> -
<a href="https://testing.googleblog.com/2008/08/tott-sleeping-synchronization.html">original post</a></p>
<p>Beware of <code>sleep</code>. <code>sleep</code> should never be used for synchronization, or in test.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">CoffeeMaker</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">CoffeeMaker</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">MakeCoffee</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">callback</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Intern</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CoffeeMaker</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">MakeCoffee</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// make coffee, hopefully within 60 seconds.
</span><span class="c1"></span>    <span class="n">callback</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Employee</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">DrinkCoffee</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span> <span class="n">caffeinated_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="nf">IsCaffeinated</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">caffeinated_</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DemandCoffee</span><span class="p">(</span><span class="n">CoffeeMaker</span><span class="o">&amp;</span> <span class="n">cm</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="kr">thread</span> <span class="n">t</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CoffeeMaker</span><span class="o">:</span><span class="o">:</span><span class="n">MakeCoffee</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cm</span><span class="p">,</span>
                  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Employee</span><span class="o">:</span><span class="o">:</span><span class="n">DrinkCoffee</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="n">t</span><span class="p">.</span><span class="n">detach</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">caffeinated_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">EmployeeTest</span><span class="p">,</span> <span class="n">ShouldBeCaffeinatedOnlyAfterDrinkingCoffee</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Employee</span> <span class="n">e</span><span class="p">;</span>
  <span class="n">Intern</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">e</span><span class="p">.</span><span class="n">DemandCoffee</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">IsCaffeinated</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">this_thread</span><span class="o">:</span><span class="o">:</span><span class="n">sleep_for</span><span class="p">(</span><span class="mi">60</span><span class="n">s</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">IsCaffeinated</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Code that sleeps can be improved by waiting on a <code>std::future</code> or a <code>std::condition_variable</code>.
As always, if your waiting on a non-trivial operation, like <code>Intern::MakeCoffee</code>, use a fake.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">FakeIntern</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CoffeeMaker</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">MakeCoffee</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">mut_</span><span class="p">)</span><span class="p">;</span>
    <span class="n">cv_</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">]</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ready_</span><span class="p">;</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>

    <span class="n">callback</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">done_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="n">lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">cv_</span><span class="p">.</span><span class="n">notify_one</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">SignalAndWait</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">mut_</span><span class="p">)</span><span class="p">;</span>
    <span class="n">ready_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">cv_</span><span class="p">.</span><span class="n">notify_one</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>

    <span class="n">cv_</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">]</span> <span class="p">{</span> <span class="k">return</span> <span class="n">done_</span><span class="p">;</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">ready_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">done_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">condition_variable</span> <span class="n">cv_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">mutex</span> <span class="n">mut_</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">EmployeeTest</span><span class="p">,</span> <span class="n">ShouldBeCaffeinatedOnlyAfterDrinkingCoffee</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Employee</span> <span class="n">e</span><span class="p">;</span>
  <span class="n">FakeIntern</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">e</span><span class="p">.</span><span class="n">DemandCoffee</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">IsCaffeinated</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">i</span><span class="p">.</span><span class="n">SignalAndWait</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">IsCaffeinated</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="defeat-static-cling">Defeat &ldquo;Static Cling&rdquo;</h2>
<p><em>June 26, 2008</em> -
<a href="https://testing.googleblog.com/2008/06/defeat-static-cling.html">original post</a></p>
<p>Static functions, like this singleton <code>GetInstance</code> method, are a sign of tight coupling.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">MyObject</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">DoSomething</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">TheirEntity</span><span class="o">:</span><span class="o">:</span><span class="n">GetInstance</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">GetSomething</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div><p>There is a way around this using the Repository Pattern.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">TheirEntityRepository</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">TheirEntityRepository</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">TheirEntity</span><span class="o">&amp;</span> <span class="n">GetInstance</span><span class="p">(</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Other static methods here
</span><span class="c1"></span><span class="p">}</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TheirEntityStaticRepository</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TheirEntityRepository</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">TheirEntity</span><span class="o">&amp;</span> <span class="n">GetInstance</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">TheirEntity</span><span class="o">:</span><span class="o">:</span><span class="n">GetInstance</span><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyObject</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">MyObject</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">TheirEntityRepository</span><span class="o">&gt;</span> <span class="n">repository</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">repository_</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">move</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span><span class="p">}</span>
  <span class="kt">int</span> <span class="nf">DoSomething</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">repository_</span><span class="o">-</span><span class="o">&gt;</span><span class="n">GetInstance</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">GetSomething</span><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">TheirEntityRepository</span><span class="o">&gt;</span> <span class="n">repository_</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div><p>All thats left is to derive a <code>MockTheirEntityRepository</code> suitable for your testing needs.</p>
<h2 id="testable-contracts-make-exceptional-neighbors">Testable Contracts Make Exceptional Neighbors</h2>
<p><em>May 28, 2008</em> -
<a href="https://testing.googleblog.com/2008/05/tott-testable-contracts-make.html">original post</a></p>
<p>Modify external visible state only after completing all operations which could possibly fail.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="n">SomeCollection</span><span class="o">:</span><span class="o">:</span><span class="n">GetObjects</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="o">&amp;</span> <span class="n">objects</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">objects</span><span class="p">.</span><span class="n">clear</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">object</span> <span class="p">:</span> <span class="n">collection_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">object</span><span class="p">.</span><span class="n">IsFubarred</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">objects</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In these situations, the <code>swap</code> trick comes in handy.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="n">SomeCollection</span><span class="o">:</span><span class="o">:</span><span class="n">GetObjects</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="o">&amp;</span> <span class="n">objects</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">known_good_objects</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">object</span> <span class="p">:</span> <span class="n">collection_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">object</span><span class="p">.</span><span class="n">IsFubarred</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">known_good_objects</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">objects</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">known_good_objects</span><span class="p">)</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now, the caller has good objects on success, or unchanged objects on failure.</p>
<h2 id="understanding-your-coverage-data">Understanding Your Coverage Data</h2>
<p><em>March 6, 2008</em> -
<a href="https://testing.googleblog.com/2008/03/tott-understanding-your-coverage-data.html">original post</a></p>
<p>High test coverage is necessary but not sufficient.</p>
<p>Use your test coverage results to look for unexpected coverage patterns, which usually indicate
bugs, and add test cases to address them.</p>
<h2 id="too-many-tests">Too Many Tests</h2>
<p><em>February 21, 2008</em> -
<a href="https://testing.googleblog.com/2008/02/in-movie-amadeus-austrian-emperor.html">original post</a></p>
<p>How many tests? Answering this question requires a good grasp of the context.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">Decide</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">e</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">|</span><span class="o">|</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="n">d</span> <span class="o">|</span><span class="o">|</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DoOneThing</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">DoAnother</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>Testing every possible input would require 2<sup>192</sup> tests. Thats too many.</li>
<li>Testing enough to get full line coverage would require 2 tests. Thats too few.</li>
<li>Testing each logical expression (e.g <code>a &gt; b</code>, <code>a == b</code>, <code>a &lt; b</code>) independently is 27 tests. Still
probably too many.</li>
</ul>
<p>More context can focus the decision.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">Decide</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">e</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">TallerThan</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">|</span><span class="o">|</span> <span class="n">HarderThan</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">|</span><span class="o">|</span> <span class="n">HeavierThan</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DoOneThing</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">DoAnother</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">TallerThan</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">bool</span> <span class="nf">HarderThan</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">bool</span> <span class="nf">HeavierThan</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">e</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div><p>Testing the cases where each extracted function is true, they all are false, and writing 2 tests for
each of the extracted functions would require 4 + 3*2 = 10 tests. Considering the number of inputs,
thats just enough tests.</p>
<h2 id="avoiding-friend-twister-in-c">Avoiding Friend Twister in C++</h2>
<p><em>October 30, 2007</em> -
<a href="https://testing.googleblog.com/2007/10/tott-avoiding-friend-twister-in-c.html">original post</a></p>
<p>&ldquo;Testing private members requires more <code>friend</code> contortions than a game of Twister®.&rdquo;</p>
<p>If you find yourself saying that, theres a better way.</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// include/my_project/dashboard.h
</span><span class="c1"></span>
<span class="k">class</span> <span class="nc">Dashboard</span> <span class="p">{</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="c1">// Declaration of functions getResults(), GetResultsFromCache(),
</span><span class="c1"></span>  <span class="c1">// GetResultsFromDatabase(), and CountPassFail()
</span><span class="c1"></span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Database</span><span class="o">&gt;</span> <span class="n">database_</span><span class="p">;</span> <span class="c1">// instantiated in constructor
</span><span class="c1"></span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">DashboardTest</span><span class="p">;</span> <span class="c1">// one friend declaration per test fixture
</span><span class="c1"></span><span class="p">}</span><span class="p">;</span>
</code></pre></div></div>

<p>Instead, make a helper class by extracting a helper class (a variant of the Pimple idiom).</p>
<p>To preserve privacy, the helper class is tucked away in a private implementation directory separate
from the public API.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// include/my_project/dashboard.h
</span><span class="c1"></span>
<span class="k">class</span> <span class="nc">ResultsLog</span><span class="p">;</span> <span class="c1">// Foreword declare extracted helper interface
</span><span class="c1"></span>
<span class="k">class</span> <span class="nc">Dashboard</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">Dashboard</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ResultsLog</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">results_</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">move</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span><span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
   <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ResultsLog</span><span class="o">&gt;</span> <span class="n">results_</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="c1">// src/results_log.h
</span><span class="c1"></span>
<span class="k">class</span> <span class="nc">ResultsLog</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// Declaration of functions getResults(), GetResultsFromCache(),
</span><span class="c1"></span>  <span class="c1">// GetResultsFromDatabase(), and CountPassFail()
</span><span class="c1"></span><span class="p">}</span><span class="p">;</span>

<span class="c1">// src/live_results_log.h
</span><span class="c1"></span>
<span class="k">class</span> <span class="nc">LiveResultsLog</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ResultsLog</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">LiveResultsLog</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Database</span><span class="o">&gt;</span> <span class="n">database</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">database_</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">move</span><span class="p">(</span><span class="n">database</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span><span class="p">}</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div></div>

<p>As an added bonus, now you can inject a <code>MockResultsLog</code> or a <code>FakeDatabase</code> for testing the
<code>Dashboard</code> class.</p>
<h2 id="refactoring-tests-in-the-red">Refactoring Tests in the Red</h2>
<p><em>April 26, 2007</em> -
<a href="https://testing.googleblog.com/2007/04/tott-refactoring-tests-in-red.html">original post</a></p>
<p>As your test suite grows, you will find yourself needing to refactor your tests. However,
your tests don&rsquo;t have tests!</p>
<p>One thing you can do is intentionally break the test, refactor the test, and make sure the test
still fails as expected.</p>
<p>Just remember to revert your code under test!</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/google-testing-blog/whittaker/" title="James Whittaker"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/unit-testing/" title="Unit Testing Principles, Practices, and Patterns" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1582391604"></script>
    <script src="/js/perfect-scrollbar.min.js?1582391604"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1582391604"></script>
    <script src="/js/jquery.sticky.js?1582391604"></script>
    <script src="/js/featherlight.min.js?1582391604"></script>
    <script src="/js/highlight.pack.js?1582391604"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1582391604"></script>
    <script src="/js/learn.js?1582391604"></script>
    <script src="/js/hugo-learn.js?1582391604"></script>

    <link href="/mermaid/mermaid.css?1582391604" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1582391604"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>


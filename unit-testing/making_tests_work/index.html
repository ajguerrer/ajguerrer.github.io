<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.65.3" />
    <meta name="theme-color" content="#85ad85">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="translucent">
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Making your Tests Work for You :: Notebook</title>

    
    <link href="/css/nucleus.css?1583003334" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1583003334" rel="stylesheet">
    <link href="/css/hybrid.css?1583003334" rel="stylesheet">
    <link href="/css/featherlight.min.css?1583003334" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1583003334" rel="stylesheet">
    <link href="/css/auto-complete.css?1583003334" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1583003334" rel="stylesheet">
    <link href="/css/theme.css?1583003334" rel="stylesheet">
    <link href="/css/hugo-theme.css?1583003334" rel="stylesheet">
    
      <link href="/css/theme-gruvbox.css?1583003334" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1583003334"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link href="/css/gruvbox-dark.css" rel="stylesheet" />
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body class="" data-url="/unit-testing/making_tests_work/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div class="logo">
  <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 90.000000 183.000000"
    preserveAspectRatio="xMidYMid meet">
    <g transform="translate(0.000000,183.000000) scale(0.100000,-0.100000)" stroke="none">
      <path d="M437 1690 c-4 -30 -7 -131 -8 -225 -2 -224 -2 -224 -62 -242 -67 -19
    -147 -97 -147 -141 0 -18 2 -32 4 -32 2 0 15 17 29 38 27 41 104 96 150 107
    l28 7 -3 -107 -3 -108 -30 -11 c-54 -19 -106 -57 -103 -75 2 -9 35 -32 74 -51
    l72 -35 7 -68 c8 -84 17 -80 19 8 l1 66 58 24 c32 13 67 31 78 41 17 15 18 19
    4 34 -8 9 -42 29 -75 45 l-60 29 0 101 c0 56 3 104 6 107 7 8 100 -29 134 -53
    14 -10 41 -40 60 -68 31 -45 50 -62 50 -46 0 17 -43 85 -72 114 -33 34 -119
    81 -149 81 -19 0 -24 43 -35 309 -8 182 -17 235 -27 151z m-11 -806 l-7 -33
    -40 18 c-68 31 -68 38 -8 66 l54 25 3 -21 c2 -12 1 -36 -2 -55z m101 50 c24
    -9 43 -21 43 -25 0 -12 -40 -36 -72 -44 -27 -7 -28 -6 -28 39 0 25 3 46 7 46
    4 0 27 -7 50 -16z" />
      <path d="M92 893 c14 -133 101 -250 231 -311 37 -18 74 -32 81 -32 8 0 17 -4
20 -8 3 -5 6 -109 7 -231 0 -123 5 -219 9 -214 19 20 30 125 30 278 l0 165 28
6 c75 17 98 25 133 50 57 39 108 107 139 183 32 77 49 157 31 147 -6 -4 -11
-12 -11 -17 0 -6 -16 -49 -36 -95 -31 -72 -46 -93 -98 -138 -69 -60 -120 -81
-176 -72 -22 3 -41 2 -45 -4 -15 -25 -86 1 -173 63 -51 37 -127 151 -148 224
-9 29 -18 53 -21 53 -3 0 -3 -21 -1 -47z" />
    </g>
  </svg>
  <p>Notebook</p>
</div>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1583003334"></script>
<script type="text/javascript" src="/js/auto-complete.js?1583003334"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ajguerrer.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1583003334"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/google-testing-blog/" title="Google Testing Blog" class="dd-item 
        
        
        
        ">
      <a href="/google-testing-blog/">
          Google Testing Blog
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/general/" title="General Notes" class="dd-item ">
        <a href="/google-testing-blog/general/">
        General Notes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/testable_code/" title="Guide to Writing Testable Code" class="dd-item ">
        <a href="/google-testing-blog/testable_code/">
        Guide to Writing Testable Code
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/whittaker/" title="James Whittaker" class="dd-item ">
        <a href="/google-testing-blog/whittaker/">
        James Whittaker
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/google-testing-blog/tott/" title="Testing on the Toilet" class="dd-item ">
        <a href="/google-testing-blog/tott/">
        Testing on the Toilet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/unit-testing/" title="Unit Testing Principles, Practices, and Patterns" class="dd-item 
        parent
        
        
        ">
      <a href="/unit-testing/">
          Unit Testing Principles, Practices, and Patterns
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/bigger_picture/" title="The Bigger Picture" class="dd-item ">
        <a href="/unit-testing/bigger_picture/">
        The Bigger Picture
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/making_tests_work/" title="Making your Tests Work for You" class="dd-item active">
        <a href="/unit-testing/making_tests_work/">
        Making your Tests Work for You
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/integration_testing/" title="Integration Testing" class="dd-item ">
        <a href="/unit-testing/integration_testing/">
        Integration Testing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/unit-testing/antipatterns/" title="Unit Testing Anti-Patterns" class="dd-item ">
        <a href="/unit-testing/antipatterns/">
        Unit Testing Anti-Patterns
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Notebook</a> > <a href='/unit-testing/'>Unit Testing Principles, Practices, and Patterns</a> > Making your Tests Work for You
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#four-pillars-of-a-good-test">Four Pillars of a Good Test</a></li>
    <li><a href="#the-ideal-test">The Ideal Test</a></li>
    <li><a href="#preventing-false-positives">Preventing False Positives</a></li>
    <li><a href="#types-of-test-doubles">Types of Test Doubles</a></li>
    <li><a href="#encapsulation">Encapsulation</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#styles-of-unit-testing">Styles of Unit Testing</a></li>
    <li><a href="#hexagonal-architecture">Hexagonal Architecture</a></li>
    <li><a href="#functional-architecture">Functional Architecture</a></li>
    <li><a href="#controller-orchestration">Controller Orchestration</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Making your Tests Work for You
            </h1>
          

        



<h2 id="four-pillars-of-a-good-test">Four Pillars of a Good Test</h2>
<ol>
<li><strong>Protection against regressions</strong> - Ability to indicate the presence of regressions.</li>
<li><strong>Resistance to refactoring</strong> - Degree to which a test can sustain refactoring without producing
a false positive.</li>
<li><strong>Fast feedback</strong> - Measure of how quickly the test executes.</li>
<li><strong>Maintainability</strong> - Ability to read and run the test.</li>
</ol>
<table>
  <tr>
    <th>Error Types</th>
    <th>Functionality is Correct</th>
    <th>Functionality is Broken</th>
  </tr>
  <tr>
    <th>Test Passes</th>
    <td>True negative</td>
    <td>False negative (indicates poor protection against regressions)</td>
  </tr>
  <tr>
    <th>Test Fails</th>
    <td>False positive (indicates poor resistance to refactoring)</td>
    <td>True positive</td>
  </tr>
</table>
<p>$$Test\ accuracy = {Signal\ (True\ positives) \over Noise\ (False\ positives)}$$</p>
<h2 id="the-ideal-test">The Ideal Test</h2>
<p>{<em>Protection against regressions</em>, <em>Resistance to refactoring</em>, <em>Fast feedback</em>} - Choose two.</p>
<p><img src="/images/ideal_test.png" alt="Ideal test"></p>
<p>Always chose to maximize <em>resistance to refactoring</em>. Then, test size becomes a slider between
<em>protection against regressions</em> and <em>fast feedback</em>.</p>
<p><img src="/images/test_triangle.png" alt="Test triangle"></p>
<p>A diverse ratio of test sizes provides an ideal amount of both <em>protection against regressions</em> and
<em>fast feedback</em>. For any non-trivial production system, test counts should form a pyramid where the
test count shrinks as test size grows.</p>
<p><img src="/images/test_pyramid.png" alt="Test pyramid"></p>
<h2 id="preventing-false-positives">Preventing False Positives</h2>
<p>When tests fail for the wrong reasons, developers quickly loose trust in their tests. However,
without trustworthy tests, refactoring is risky. This trap leads to real bugs slipping through.</p>
<p>Fast positives are formed from coupling between the test and implementation details:</p>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">Render</span><span class="p">,</span> <span class="n">IsCorrect</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">in</span><span class="p">(</span><span class="s">&#34;message_renderer.cc&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">sstr</span><span class="p">;</span>
  <span class="n">sstr</span> <span class="o">&lt;&lt;</span> <span class="n">in</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span>

  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">sstr</span><span class="p">.</span><span class="n">str</span><span class="p">(),</span> <span class="n">R</span><span class="s">&#34;(#include &#34;</span><span class="n">message_renderer</span><span class="p">.</span><span class="n">h</span><span class="s">&#34;</span>
<span class="cp">#include</span> <span class="cpf">&#34;body_renderer.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;title_renderer.h&#34;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;footer_renderer.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;numeric&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">MessageRenderer</span><span class="o">::</span><span class="n">MessageRenderer</span><span class="p">()</span>
    <span class="o">:</span> <span class="n">sub_renderers_</span><span class="p">({</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">TitleRenderer</span><span class="o">&gt;</span><span class="p">(),</span>
                      <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">BodyRenderer</span><span class="o">&gt;</span><span class="p">(),</span>
                      <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">FooterRenderer</span><span class="o">&gt;</span><span class="p">()})</span> <span class="p">{}</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">MessageRenderer</span><span class="o">::</span><span class="n">Render</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">sub_renderers_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">sub_renderers_</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
                         <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">{},</span>
                         <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Renderer</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                           <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">Render</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
                         <span class="p">});</span>
<span class="p">})</span><span class="s">&#34;);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Instead of testing the code, test the behavior.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">TEST</span><span class="p">(</span><span class="n">Render</span><span class="p">,</span> <span class="n">BasicMessage</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MessageRenderer</span> <span class="n">renderer</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">Message</span> <span class="n">message</span><span class="p">{</span><span class="nl">title</span> <span class="p">:</span> <span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="nl">body</span> <span class="p">:</span> <span class="s">&#34;b&#34;</span><span class="p">,</span> <span class="nl">footer</span> <span class="p">:</span> <span class="s">&#34;c&#34;</span><span class="p">};</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">html</span> <span class="o">=</span> <span class="n">renderer</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">html</span><span class="p">,</span>
            <span class="s">&#34;&lt;head&gt;&lt;title&gt;a&lt;/title&gt;&lt;/head&gt;&lt;body&gt;b&lt;/body&gt;&lt;footer&gt;c&lt;/footer&gt;&#34;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="types-of-test-doubles">Types of Test Doubles</h2>
<ul>
<li><strong>Mock</strong> <em>(mock, spy)</em> - Emulate and assert <em>outgoing</em> interactions from the SUT.</li>
<li><strong>Stub</strong> <em>(stub, dummy, fake)</em> - Emulate <em>incoming</em> interactions to the SUT.</li>
</ul>

<div class="notices note" ><p>The term <em>mock</em> can also refer to the mocking framework itself. Mocking frameworks are also
generally responsible for creating stubs which can be confusing.</p>
</div>

<p>Mocks are stubs, but stubs aren&rsquo;t mocks. Asserting interactions with stubs is a common anti-pattern
called <em>over-specification</em>.</p>
<h2 id="encapsulation">Encapsulation</h2>
<p>A well-designed API hides all implementation details behind a private API, leaving only the
observable behavior in the public API. Implementation details should not <em>leak</em> into the public API.</p>
<h4 id="invariant-violation">Invariant violation</h4>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetName</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">name_</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">NormalizeName</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">absl</span><span class="o">::</span><span class="n">StripAsciiWhitespace</span><span class="p">(</span><span class="n">name</span><span class="p">)).</span><span class="n">substr</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>


<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">normalized_name</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">NormalizeName</span><span class="p">(</span><span class="n">new_name</span><span class="p">);</span>
<span class="n">user</span><span class="p">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">normalized_name</span><span class="p">);</span>
</code></pre></div></div>

<p>As a rule of thumb, a client should be able to achieve any individual goal atomically. Otherwise,
the client is at risk of a <em>invariant violation</em>.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetName</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">name_</span> <span class="o">=</span> <span class="n">NormalizeName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">NormalizeName</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">absl</span><span class="o">::</span><span class="n">StripAsciiWhitespace</span><span class="p">(</span><span class="n">name</span><span class="p">)).</span><span class="n">substr</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>


<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">user</span><span class="p">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">new_name</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="leaking-state">Leaking state</h4>

<div class="notices warning" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">MessageRenderer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Renderer</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Renderer</span><span class="o">&gt;&gt;</span> <span class="n">GetSubRenderers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">sub_renderers_</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Render</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">);</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Renderer</span><span class="o">&gt;&gt;</span> <span class="n">sub_renderers_</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Clients shouldn&rsquo;t need direct access to internally managed state. Use dependency injection and
tell instead of asking.</p>

<div class="notices tip" ><div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">MessageRenderer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Renderer</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Render</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">);</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Renderer</span><span class="o">&gt;&gt;</span> <span class="n">sub_renderers_</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="styles-of-unit-testing">Styles of Unit Testing</h2>
<ul>
<li><strong>Output-based</strong> - Verify output with a given input. Requires
<a href="#functional-architecture">pure functions</a>.</li>
<li><strong>State-based</strong> - Perform operation, then verify state of SUT and collaborators.</li>
<li><strong>Communication-based</strong> - Perform operation, then verify communication with collaborators.</li>
</ul>
<table>
<thead>
<tr>
<th>Style</th>
<th>Output-based</th>
<th>State-based</th>
<th>Communication-based</th>
</tr>
</thead>
<tbody>
<tr>
<td>Resistance to refactoring</td>
<td>High</td>
<td>Medium</td>
<td>Medium</td>
</tr>
<tr>
<td>Maintainability</td>
<td>High</td>
<td>Medium</td>
<td>Low</td>
</tr>
</tbody>
</table>
<h2 id="hexagonal-architecture">Hexagonal Architecture</h2>
<p>Hexagonal Architecture, proposed by Alistair Cockburn, breaks applications into two layers:</p>
<ul>
<li><strong>Domain layer</strong> - Algorithms and domain models essential to the business.</li>
<li><strong>Controller layer</strong> - All other responsibilities of the application.</li>
</ul>
<p>Interaction between the Domain layer and the Controller layer follow three guidelines:</p>
<ol>
<li>The Domain layer is isolated from the Controller layer.</li>
<li>The Domain layer may not depend on the Controller layer, but the Controller layer may
depend on the Domain layer.</li>
<li>Communication with external applications is handled by the Controller layer, not the
Domain layer.</li>
</ol>
<p><img src="/images/hexagonal_architecture.png" alt="Hexagonal Architecture"></p>

<div class="notices tip" ><p>The Domain layer has high cyclomatic complexity and domain significance, while the Controller layer
has a large number of collaborators. Code that is both complex and involves many collaborators is
overcomplicated and what Hexagonal Architecture aims to dissolve.</p>
</div>

<p>Communication can be divided into two different types:</p>
<ul>
<li><strong>Intra-system</strong> - Communication within the application; implementation details.</li>
<li><strong>Inter-system</strong> - Communication with other applications; observable behavior.</li>
</ul>
<p>Mocks are necessary for emulating external applications and verifying inter-system communication
patterns. However, mocks couple tests to implementation details, reducing their resistance to
refactoring. For this reason, the use of mocks should be avoided when dealing with intra-system
communication. Out-of-process dependencies only accessible by the application, are implementation
details too, and should not be mocked either.</p>
<h2 id="functional-architecture">Functional Architecture</h2>
<p>Functional architecture builds off of Hexagonal Architecture with an added guideline that business
logic is written in a functional paradigm. The architecture generally flows in a three step process:</p>
<ol>
<li>The Controller layer gathers and prepare input.</li>
<li>The Domain layer makes decisions based on prepared input.</li>
<li>The Controller layer converts decisions into side effects.</li>
</ol>
<p><img src="/images/functional_architecture.png" alt="Functional Architecture"></p>
<blockquote>
<p>Object-oriented programming makes code understandable by encapsulating moving parts. Functional
programming makes code understandable by minimizing moving parts. <em>&ndash;Michael Feathers</em></p>
</blockquote>
<p>Functional architectures trade maintainability for performance; pure functions tend to eagerly load
data when they could have been lazy.</p>
<h2 id="controller-orchestration">Controller Orchestration</h2>
<p>Functional architecture assumes a clearcut pipeline of inputs, decisions, and side effects. However,
production applications are rarely that simple. What if those decisions lead to gathering more input
and making more decisions? There are three strategies to consider:</p>
<ol>
<li><strong>Eagerly gather all the input</strong> - Preserve controller simplicity and isolated domain logic,
but concede performance.</li>
<li><strong>Inject dependencies into the Domain layer</strong> - Preserve controller simplicity and performance, but
concede isolated domain logic.</li>
<li><strong>Allow controller orchestration</strong> - Preserve isolated domain logic and performance, but concede
controller simplicity.</li>
</ol>
<p>Isolated domain logic is an attribute that should always be maximized because it has a huge impact
on <em>maintainability</em> and <em>resistance to refactoring</em>. In cases where performance is not critical,
feel free to stick to a Functional Architecture. Otherwise, controllers will need to orchestrate
gathering input as a side effect of decisions from the Domain layer.</p>

<div class="notices tip" ><p>Controller orchestration will make controllers more complex, but complexity can be mitigated with
familiar patterns like switching on a result or listening for events.</p>
</div>



<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/unit-testing/bigger_picture/" title="The Bigger Picture"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/unit-testing/integration_testing/" title="Integration Testing" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1583003334"></script>
    <script src="/js/perfect-scrollbar.min.js?1583003334"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1583003334"></script>
    <script src="/js/jquery.sticky.js?1583003334"></script>
    <script src="/js/featherlight.min.js?1583003334"></script>
    <script src="/js/highlight.pack.js?1583003334"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1583003334"></script>
    <script src="/js/learn.js?1583003334"></script>
    <script src="/js/hugo-learn.js?1583003334"></script>

    <link href="/mermaid/mermaid.css?1583003334" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1583003334"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

